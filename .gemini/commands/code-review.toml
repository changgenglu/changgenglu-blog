description = "åŸ·è¡Œ AI Code Reviewï¼Œä¾æ“šå¯©æ ¸è¦ç¯„åˆ†æ git diff è®Šæ›´"

git_diff = "git diff origin/master...HEAD -- . ':(exclude)package-lock.json' ':(exclude)composer.lock' ':(exclude)*.lock'"
current_time = "date '+%Y-%m-%d %H:%M'"

prompt = """
# ============================================
# è¡Œç‚ºç´„æŸï¼ˆå®¢è£½åŒ–éœ€æ±‚ï¼‰
# ============================================
behavior_constraints:
  ç¦æ­¢äº‹é …:
    - "ç¦æ­¢æå‡ºåå•æˆ–è«‹æ±‚è£œå……è³‡è¨Š"
    - "ç¦æ­¢æ¨ç†éç¨‹èªªæ˜"
    - "ç¦æ­¢å‰è¨€ã€çµèªã€å»ºè­°æ€§å¯’æš„"
    - "ç¦æ­¢å‡è¨­æœªè®Šæ›´çš„ç¨‹å¼ç¢¼"

  å¯©æŸ¥ç¯„åœ:
    rule: "åªè©•è«–ã€Œgit diff ä¸­å¯¦éš›å‡ºç¾çš„å…§å®¹ã€"

  å¿½ç•¥é …ç›®:
    description: "ä»¥ä¸‹é …ç›®å‡è¨­å·²ç”± linter/IDE/CI è™•ç†ï¼Œä¸éœ€å¯©æŸ¥"
    items:
      - "ç¸®æ’ã€ç©ºæ ¼ã€ç©ºè¡Œã€å¤§æ‹¬å¼§ä½ç½®"
      - "æª”æ¡ˆç·¨ç¢¼èˆ‡æ›è¡Œç¬¦è™Ÿ"
      - "ç´”èªæ³•éŒ¯èª¤"

# ============================================
# æŠ€èƒ½è¼‰å…¥ï¼ˆå‹•æ…‹æ¿€æ´»ï¼‰
# ============================================
# åŸºç¤æŠ€èƒ½ï¼ˆæ¯æ¬¡å¯©æŸ¥å¿…è¼‰ï¼‰ï¼š
# - coding-standard-expert: å‘½åè¦ç¯„ã€é™£åˆ—çµæ§‹ã€Validation å¯«æ³•
# - architecture-reviewer: SOLID åŸå‰‡ã€å¤šå±¤æ¶æ§‹ã€DDD

# å‹•æ…‹æŠ€èƒ½è¼‰å…¥è¦å‰‡ï¼š
# åœ¨ã€Œåˆæ­¥æƒæã€éšæ®µå®Œæˆå¾Œï¼Œæ ¹æ“šè®Šæ›´å…§å®¹åˆ¤æ–·æ˜¯å¦éœ€è¦é¡å¤–è¼‰å…¥ä»¥ä¸‹ Skillsï¼š
#
# | åµæ¸¬æ¢ä»¶                                      | è¼‰å…¥ Skill             |
# |----------------------------------------------|------------------------|
# | æ¶‰åŠ SQL/Eloquent/Repository/Migration       | database-architect     |
# | æ¶‰åŠ Redis/Cache/Session/Queue               | redis-architect        |
# | æ¶‰åŠèªè­‰/æˆæ¬Š/Token/å¯†ç¢¼/æ•æ„Ÿè³‡æ–™             | security-auditor       |
# | æ¶‰åŠ Controller/Route/API ç«¯é»               | api-designer           |
# | æ¶‰åŠå¤§é‡è¿´åœˆ/æ‰¹æ¬¡è™•ç†/åˆ†é /æ•ˆèƒ½æ•æ„Ÿæ“ä½œ       | performance-analyst    |
# | æ¶‰åŠ Laravel ç‰¹å®šåŠŸèƒ½ (Middleware/Event/Job) | laravel-expert         |
# | æ¶‰åŠ Test/PHPUnit/Feature Test               | qa-tester              |

# ============================================
# å¯©æ ¸æµç¨‹
# ============================================
review_process:
  1_initial_scan:
    description: "åˆæ­¥æƒæè®Šæ›´å…§å®¹ä¸¦æ±ºå®šå‹•æ…‹è¼‰å…¥æŠ€èƒ½"
    actions:
      - "è­˜åˆ¥è®Šæ›´æª”æ¡ˆé¡å‹èˆ‡æ•¸é‡"
      - "åˆ¤æ–·è®Šæ›´é¡å‹ï¼ˆæ–°åŠŸèƒ½/ä¿®å¾©/é‡æ§‹ï¼‰"
      - "è©•ä¼°å½±éŸ¿ç¯„åœ"
      - "æ ¹æ“šä¸Šè¿°å‹•æ…‹æŠ€èƒ½è¼‰å…¥è¦å‰‡ï¼Œæ±ºå®šé¡å¤–è¼‰å…¥å“ªäº› Skills"


  2_detailed_review:
    description: "è©³ç´°å¯©æ ¸å„é …ç›®ï¼ˆåƒè€ƒå°æ‡‰ Skillï¼‰"
    categories:
      - name: "SOLID åŸå‰‡"
        weight: 25
        skill: "architecture-reviewer"
      - name: "ç¨‹å¼ç¢¼å“è³ª"
        weight: 20
        skill: null
      - name: "Coding Style"
        weight: 15
        skill: "coding-standard-expert"
      - name: "åŠŸèƒ½æ­£ç¢ºæ€§"
        weight: 15
        skill: null
      - name: "å®‰å…¨æ€§"
        weight: 15
        skill: "security-auditor"
      - name: "æ•ˆèƒ½"
        weight: 5
        skill: "performance-analyst"
      - name: "å¯æ¸¬è©¦æ€§"
        weight: 5
        skill: null

  3_scoring:
    description: "è©•åˆ†èˆ‡ç”¢å‡ºå ±å‘Š"
    actions:
      - "è¨ˆç®—å„é¡åˆ¥å¾—åˆ†"
      - "ç”¢å‡ºå•é¡Œæ¸…å–®"
      - "æ’°å¯«å¯©æŸ¥æ„è¦‹"

# ============================================
# ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (æ¬Šé‡ 20%)
# ============================================
code_quality:
  weight: 20

  naming:
    rules:
      - "class: PascalCaseï¼Œåè©"
      - "method: camelCaseï¼Œå‹•è©é–‹é ­"
      - "variable: camelCaseï¼Œæœ‰æ„ç¾©çš„åç¨±"
      - "constant: UPPER_SNAKE_CASE"
    red_flags:
      - "å–®å­—æ¯è®Šæ•¸ï¼ˆè¿´åœˆç´¢å¼•é™¤å¤–ï¼‰"
      - "ç¸®å¯«ä¸æ˜ç¢º"
      - "åç¨±èˆ‡å¯¦éš›è¡Œç‚ºä¸ç¬¦"

  complexity:
    thresholds:
      cyclomatic_complexity: 10
      method_lines: 50
      class_lines: 500
      parameters: 5
      nesting_depth: 4

  duplication:
    threshold: "3 è™•ä»¥ä¸Šç›¸ä¼¼ç¨‹å¼ç¢¼éœ€æå–"

# ============================================
# Coding Style æª¢æŸ¥ (æ¬Šé‡ 15%)
# ============================================
coding_style:
  weight: 15

  naming:
    variable:
      rule: "å°é§å³°"
      correct: "$userEmail"
      incorrect: "$user_email"
    constant:
      rule: "å…¨å¤§å¯«+åº•ç·š"
      correct: "COMPANY_IP"
      incorrect: "CompanyIp"
    class:
      rule: "å¤§é§å³°"
      correct: "MemberController"
      incorrect: "member_controller"
    interface:
      rule: "I é–‹é ­"
      correct: "IGame"
      incorrect: "GameInterface"

  array_format:
    declaration:
      correct: "$array = [];"
      incorrect: "$array = array();"

  braces:
    function:
      rule: "å¤§æ‹¬å¼§æ›è¡Œ"
    control_structure:
      rule: "å¤§æ‹¬å¼§ä¸æ›è¡Œ"

  cache_key:
    format: "å‰ç¶´_æè¿°:è®Šæ•¸"
    correct:
      - "user_profile:123"
      - "game_code:1:2345"

  validation:
    rule: "ä½¿ç”¨é™£åˆ—æ ¼å¼"

  api_design:
    http_methods:
      GET: "å–å¾—è³‡æ–™"
      POST: "æ–°å¢è³‡æ–™"
      PUT: "ä¿®æ”¹è³‡æ–™"
      DELETE: "åˆªé™¤è³‡æ–™"
    parameter_rule: "åƒæ•¸åœ¨ Bodyï¼Œä¸åœ¨ URL"

# ============================================
# åŠŸèƒ½æ­£ç¢ºæ€§æª¢æŸ¥ (æ¬Šé‡ 15%)
# ============================================
correctness:
  weight: 15

  checks:
    - "æ¥­å‹™é‚è¼¯æ˜¯å¦ç¬¦åˆéœ€æ±‚è¦æ ¼"
    - "null/ç©ºé™£åˆ—/ç©ºå­—ä¸²/æ¥µç«¯å€¼è™•ç†"
    - "ä¾‹å¤–æ˜¯å¦é©ç•¶æ•ç²"
    - "éŒ¯èª¤è¨Šæ¯æ˜¯å¦æœ‰æ„ç¾©"
    - "ç«¶çˆ­æ¢ä»¶èˆ‡æ­»é–é¢¨éšª"
    - "äº¤æ˜“ç¯„åœèˆ‡å›æ»¾æ©Ÿåˆ¶"

# ============================================
# å¯æ¸¬è©¦æ€§æª¢æŸ¥ (æ¬Šé‡ 5%)
# ============================================
testability:
  weight: 5

  checks:
    - "æ˜¯å¦æœ‰å°æ‡‰çš„å–®å…ƒæ¸¬è©¦"
    - "ä¾è³´æ˜¯å¦å¯è¢« mock"
    - "é‚Šç•Œæ¢ä»¶æ˜¯å¦è¦†è“‹"
    - "æ˜¯å¦æ¸¬è©¦ç•°å¸¸æƒ…æ³"

# ============================================
# è¼¸å‡ºæ ¼å¼ï¼ˆå¿…é ˆåš´æ ¼éµå¾ªï¼‰
# ============================================

è«‹å°‡å ±å‘Šå¯«å…¥åˆ° GitHub å„²å­˜åº«ï¼ˆGitHub repo MCPï¼‰ `changgenglu/changgenglu-blog` çš„ `code-review/` ç›®éŒ„ä¸­ã€‚

GitHub repo MCP æŒ‡å—ï¼š
1. é¦–å…ˆä½¿ç”¨ `get_file_contents` æª¢æŸ¥æ˜¯å¦å­˜åœ¨åŒåæª”æ¡ˆã€‚
2. ä½¿ç”¨ `create_or_update_file` å·¥å…·ã€‚
3. åƒæ•¸è¨­å®šï¼š
   - `owner`: "changgenglu"
   - `repo`: "changgenglu-blog"
   - `path`: "code-review/<filename>"
   - `content`: <content>
   - `message`: "docs: cr report: <filename>" æˆ– "docs: update cr report: <filename>"ï¼ˆè‹¥ç‚ºæ›´æ–°ï¼‰
   - `branch`: "master" (æˆ–é è¨­åˆ†æ”¯)
   - `sha`: è‹¥ç‚ºæ›´æ–°ç¾æœ‰æª”æ¡ˆï¼Œéœ€æä¾›åŸæª”æ¡ˆçš„ SHA
4. å®Œæˆå¾Œå›å ±å¯«å…¥çš„æª”æ¡ˆè·¯å¾‘èˆ‡ç‹€æ…‹ã€‚

**filename å‘½åè¦å‰‡**ï¼š
- ä½¿ç”¨åˆ†æ”¯åç¨±ä½œç‚ºæª”æ¡ˆåç¨±ï¼ˆä¸å«æ™‚é–“æˆ³æˆ–æµæ°´è™Ÿï¼‰
- ç¯„ä¾‹ï¼šåˆ†æ”¯ `feature-inbox` â†’ `feature-inbox.md`

**æ–‡ä»¶æ›´æ–°é‚è¼¯**ï¼š
- è‹¥å·²å­˜åœ¨åŒåæª”æ¡ˆï¼Œå‰‡æ›´æ–°è©²æª”æ¡ˆå…§å®¹ï¼Œä¸¦åœ¨ç‰ˆæœ¬è¨˜éŒ„å€å¡Šæ–°å¢ä¸€ç­†è¨˜éŒ„
- æ–°å»ºæª”æ¡ˆæ™‚ï¼Œç‰ˆæœ¬è¨˜éŒ„å¾ v1.0 é–‹å§‹ï¼›æ›´æ–°æ™‚éå¢ç‰ˆæœ¬è™Ÿï¼ˆå¦‚ v1.1, v1.2...ï¼‰

è«‹ä¾ç…§ä»¥ä¸‹ Markdown æ¨¡æ¿è¼¸å‡ºï¼Œç¦æ­¢æ–°å¢æˆ–åˆªæ¸›å€å¡Šï¼š

```markdown
# <filename>

## ç‰ˆæœ¬è¨˜éŒ„

| ç‰ˆæœ¬ | æ›´æ–°æ™‚é–“ | è®Šæ›´æ‘˜è¦ |
|------|---------|----------|
| v1.0 | {{current_time}} | åˆæ¬¡å¯©æŸ¥ |

---

## è®Šæ›´æ‘˜è¦

| é …ç›® | å…§å®¹ |
|-----|-----|
| è®Šæ›´æª”æ¡ˆæ•¸ | N å€‹ |
| è®Šæ›´é¡å‹ | æ–°åŠŸèƒ½ / ä¿®å¾© / é‡æ§‹ |
| å½±éŸ¿ç¯„åœ | ç°¡è¿°å½±éŸ¿æ¨¡çµ„ |

---

## å•é¡Œæ¸…å–®

### ğŸ”´ åš´é‡ï¼ˆå¿…é ˆä¿®å¾©ï¼‰
| æª”æ¡ˆ:è¡Œè™Ÿ | å•é¡Œæè¿° | å»ºè­°ä¿®å¾© |
|----------|---------|---------| 
| `path/file.php:123` | SQL Injection é¢¨éšª | ä½¿ç”¨ Eloquent æˆ–åƒæ•¸åŒ–æŸ¥è©¢ |

### ğŸŸ¡ è­¦å‘Šï¼ˆå»ºè­°ä¿®å¾©ï¼‰
| æª”æ¡ˆ:è¡Œè™Ÿ | å•é¡Œæè¿° | å»ºè­°ä¿®å¾© |
|----------|---------|---------| 
| `path/file.php:45` | N+1 æŸ¥è©¢å•é¡Œ | ä½¿ç”¨ with() é è¼‰å…¥ |

### ğŸ”µ å»ºè­°ï¼ˆå¯é¸ä¿®å¾©ï¼‰
| æª”æ¡ˆ:è¡Œè™Ÿ | å•é¡Œæè¿° | å»ºè­°ä¿®å¾© |
|----------|---------|---------| 
| `path/file.php:78` | è®Šæ•¸å‘½åä¸ç¬¦è¦ç¯„ | $user_data æ”¹ç‚º $userData |

---

## å¯©æŸ¥çµè«–

### å„é¡åˆ¥è©•åˆ†

| é¡åˆ¥ | æ¬Šé‡ | å¾—åˆ† | ç‹€æ…‹ | èªªæ˜ |
|-----|-----|-----|-----|-----|
| SOLID åŸå‰‡ | 25% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| ç¨‹å¼ç¢¼å“è³ª | 20% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| åŠŸèƒ½æ­£ç¢ºæ€§ | 15% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| å®‰å…¨æ€§ | 15% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| å¤šå±¤æ¶æ§‹ | 15% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| æ•ˆèƒ½ | 5% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |
| å¯æ¸¬è©¦æ€§ | 5% | 0-100 | âœ…/âš ï¸/âŒ | ç°¡è¿° |

### ç¸½åˆ†è¨ˆç®—

**åŠ æ¬Šç¸½åˆ†**ï¼šXX / 100

### åˆä½µåˆ¤å®š

| åˆ†æ•¸å€é–“ | åˆ¤å®š | è¡Œå‹• |
|---------|-----|-----|
| 90-100 | âœ… å„ªç§€ | å¯ç›´æ¥åˆä½µ |
| 70-89 | âš ï¸ è‰¯å¥½ | ä¿®å¾©è­¦å‘Šå¾Œå¯åˆä½µ |
| 50-69 | âš ï¸ å¾…æ”¹å–„ | å¿…é ˆä¿®å¾©å•é¡Œ |
| 0-49 | âŒ æ‹’çµ• | éœ€é‡å¤§ä¿®æ”¹ |

**æœ€çµ‚çµè«–**ï¼šâœ… å¯åˆä½µ / âš ï¸ ä¿®å¾©å¾Œå¯åˆä½µ / âŒ éœ€é‡å¤§ä¿®æ”¹
```

# ============================================
# å¯©æŸ¥å®Œæˆé€šçŸ¥ï¼ˆLINE MCPï¼‰
# ============================================

å®Œæˆ code review å¾Œï¼Œä½¿ç”¨ `push_text_message` ç™¼é€æ‘˜è¦é€šçŸ¥ï¼š

**MCP å‘¼å«ç¯„ä¾‹**ï¼š
{
  "tool": "push_text_message",
  "arguments": {
    "message": {
      "text": "ğŸ“‹ å¯©æŸ¥å…§å®¹ï¼š\n{ git branch name }\nâš’ï¸ åŠŸèƒ½èªªæ˜ï¼š\n{å›ç­”é‡é»ï¼Œ2-3 å¥}\nğŸ’¡ å¯©æŸ¥çµæœï¼š\n{å›ç­”é‡é»ï¼Œ2-3 å¥}\nâš ï¸ æ³¨æ„ï¼š\n{è‹¥æœ‰é‡è¦æé†’å‰‡åˆ—å‡ºï¼Œå¦å‰‡çœç•¥}"
    }
  }
}

---

# ============================================
# å¯©æŸ¥ä¾†æºï¼ˆæ“‡ä¸€ï¼‰
# ============================================

{{#if input}}
```diff
{{input}}
````

{{else}}

```diff
{{git_diff}}
```

{{/if}}
"""
