# gemini-cli-ralph 使用說明

## 1. 核心理念

Ralph Wiggum 方法論的核心精神：

| 原則 | 說明 |
|------|------|
| **迭代 > 完美** | 不追求首次完美，透過多次改進來精煉 |
| **失敗即數據** | 每次失敗都是可識別和可修復的學習機會 |
| **堅持就是勝利** | 持續嘗試直到成功 |
| **信任過程** | 不要用虛假的完成來規避迴圈 |

---

## 2. 啟動迴圈

### 語法

```bash
/ralph-loop <任務描述> [選項]
```

### 選項

| 選項 | 說明 |
|------|------|
| `--max-iterations <n>` | 最大迭代次數（預設：無限制） |
| `--completion-promise '<text>'` | 完成承諾短語 |

### 使用技巧

1. **明確定義完成標準**
   - 設定具體且可驗證的 `--completion-promise`
   - 優先使用客觀標準：測試通過、建置成功、lint 無錯誤

2. **提示詞設計原則**
   - 簡潔且聚焦，避免過度複雜
   - 指定期望的輸出格式
   - 使用正面指令（做什麼）而非負面指令（不要做什麼）

3. **設定合理的迭代上限**
   - 簡單任務：5-10 次
   - 中等複雜度：10-20 次
   - 複雜重構：20-50 次

### 範例

```bash
# ✅ 好的範例：明確的完成標準
/ralph-loop 修復登入驗證 bug，確保所有測試通過 --completion-promise 'ALL TESTS PASSING' --max-iterations 15

# ✅ 好的範例：具體的任務描述
/ralph-loop 為 UserService 新增單元測試，覆蓋率達到 80% --completion-promise 'COVERAGE COMPLETE' --max-iterations 20

# ⚠️ 避免：模糊的任務描述
/ralph-loop 改善程式碼品質
```

### 自檢清單

- [ ] 任務描述是否具體且可量化？
- [ ] 完成標準是否客觀可驗證？
- [ ] 迭代次數是否合理？
- [ ] 是否屬於適合 Ralph 的任務類型？

---

## 3. 適用場景

### ✅ 最適合的任務

| 場景 | 說明 |
|------|------|
| **大規模重構** | 框架遷移、API 更新、程式碼標準化 |
| **測試驅動開發** | 迭代直到所有測試通過 |
| **批次操作** | 文件生成、型別註解、格式統一 |
| **明確規格的新功能** | 有清楚定義的 greenfield 開發 |

### ❌ 不適合的任務

| 場景 | 原因 |
|------|------|
| **模糊的需求** | 缺乏客觀完成標準 |
| **複雜架構決策** | 需要人類判斷和權衡 |
| **安全關鍵程式碼** | 需要謹慎的人工審查 |
| **探索性工作** | 目標不明確，難以定義完成 |

### 自檢清單

- [ ] 任務是否有明確的成功/失敗標準？
- [ ] 結果是否可透過自動化驗證（測試、lint、建置）？
- [ ] 任務是否具有重複性或規律性？
- [ ] 是否不需要頻繁的人工決策？

---

## 4. 監控與迭代

### 監控狀態

```bash
cat .gemini/ralph-loop.local.md
```

### 狀態檔案內容

```yaml
---
active: true
iteration: 5
max_iterations: 20
completion_promise: "DONE"
started_at: "2025-01-26T04:00:00Z"
---
```

### 使用技巧

1. **建立外部記憶機制**
   - 利用 `IMPLEMENTATION_PLAN.md` 作為真相來源
   - 讓 Gemini 將進度寫入檔案，避免 context 累積

2. **設置 Guardrails**
   - 在 `GEMINI.md` 中定義專案規範
   - 明確禁止不希望的行為

3. **觀察迭代模式**
   - 如果連續多次迭代沒有進展，考慮調整提示詞
   - 失敗模式可能暗示需要更明確的指引

### 自檢清單

- [ ] 是否定期檢查迭代進度？
- [ ] 是否有外部檔案記錄工作進度？
- [ ] Gemini 是否有足夠的 guardrails？
- [ ] 迭代是否有明顯的進步趨勢？

---

## 5. 終止迴圈

### 正常完成

當任務真正完成時，Gemini 會輸出：

```
<promise>YOUR_COMPLETION_PHRASE</promise>
```

### 手動取消

```bash
/cancel-ralph
```

### 使用技巧

1. **誠實輸出承諾**
   - 只有當陳述確實為真時才輸出承諾
   - 切勿為了退出迴圈而謊報完成

2. **評估取消時機**
   - 迭代無進展超過 3-5 次
   - 發現任務需要重新定義
   - 遇到需要人工決策的阻塞點

### 自檢清單

- [ ] 完成標準是否真正達成？
- [ ] 所有自動化驗證是否通過？
- [ ] 是否有未完成的子任務？
- [ ] 程式碼品質是否符合專案標準？

---

## 6. 最佳實踐總結

| 階段 | 關鍵行動 |
|------|----------|
| **啟動前** | 定義明確目標、設定客觀標準、準備 guardrails |
| **執行中** | 定期監控、觀察模式、必要時調整 |
| **完成後** | 驗證結果、審查變更、記錄學習 |

### 黃金法則

> **「Ralph 的核心就是一個 Bash 迴圈」** — Geoffrey Huntley
>
> 簡單、持續、迭代。讓 AI 反覆嘗試，從失敗中學習，直到成功。
