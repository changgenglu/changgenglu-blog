# AI Code Review 指導規則

## 概述
本規則為 AI 進行 code review 時的標準作業程序，確保檢查過程一致且全面。

## 執行原則

### 1. 檢查範圍
- **僅檢查異動程式碼**：只檢查此分支修改的檔案，不檢查原有程式碼
- **不實作修改**：code review 完不幫實作，僅提供建議和討論
- **列出檢查檔案**：明確列出所有檢查的檔案清單

### 2. 回應要求
- **檔案位置**：有修改建議需給出相對應檔案的位置及行數

## 檢查項目

### 1. 符合 CodingStyle 規範

#### PHP 類型聲明
- 檢查所有方法參數都有類型聲明
- 檢查回傳值有類型聲明

#### 變數命名
- 檢查使用 camelCase 命名規範
- 檢查變數名稱具描述性
- 檢查常數使用 ALL_CAPS 格式
- 檢查方法名稱以動詞開頭

#### 程式碼格式
- 檢查大括號位置符合規範
- 檢查縮排使用空格（4個空格）
- 檢查陣列格式符合多行規範
- 檢查字串使用單引號

### 2. 核心調整對現有 API 的 I/O 影響

#### 向後相容性
- 檢查新增功能不影響現有 API 結構
- 檢查現有 API 端點保持不變
- 檢查回傳格式與現有 API 一致

#### API 設計
- 檢查遵循現有的 API 命名規範
- 檢查參數結構與現有 API 保持一致
- 檢查錯誤處理使用統一的異常類型

### 3. 結構設計

#### 分層架構
- 檢查介面定義清晰
- 檢查抽象類別設計合理
- 檢查服務層職責單一
- 檢查依賴注入使用適當

#### 模組化設計
- 檢查功能模組化
- 檢查可重用性高
- 檢查耦合度低
- 檢查內聚性高

### 4. 變數命名

#### 命名規範
- 檢查變數名稱清晰易懂
- 檢查避免縮寫和簡寫
- 檢查使用有意義的名稱
- 檢查避免魔法數字和字串

#### 命名一致性
- 檢查同類型變數使用相同命名模式
- 檢查布林值使用 is/has/can 前綴
- 檢查集合使用複數形式

### 5. 商業邏輯

#### 邏輯正確性
- 檢查業務規則實作正確
- 檢查邊界條件處理適當
- 檢查異常情況有適當處理
- 檢查資料驗證完整

#### 效能考量
- 檢查避免不必要的資料庫查詢
- 檢查使用適當的快取策略
- 檢查避免 N+1 查詢問題
- 檢查記憶體使用合理

### 6. 效能

#### 時間複雜度
- 檢查演算法效率合理
- 檢查避免不必要的迴圈
- 檢查使用適當的資料結構

#### 空間複雜度
- 檢查記憶體使用合理
- 檢查避免記憶體洩漏
- 檢查適當的物件生命週期管理

## 安全性檢查

### 1. 輸入驗證
- 檢查所有外部輸入都有驗證
- 檢查使用白名單驗證
- 檢查避免 SQL 注入
- 檢查避免 XSS 攻擊

### 2. 資料處理
- 檢查敏感資料適當加密
- 檢查避免在日誌中記錄敏感資訊
- 檢查使用參數化查詢
- 檢查適當的權限檢查

## 維護性評估

### 1. 程式碼可讀性
- 檢查註解完整且準確
- 檢查程式碼邏輯清晰
- 檢查函數長度適當
- 檢查複雜度控制合理

### 2. 可擴展性
- 檢查設計支援未來擴展
- 檢查使用介面和抽象類別
- 檢查配置與程式碼分離
- 檢查模組化設計

### 3. 測試友善
- 檢查方法可獨立測試
- 檢查依賴注入使用適當
- 檢查異常處理便於測試
- 檢查邊界條件可測試

## AI Code Review 執行流程

### 1. 準備階段
1. 確認檢查範圍（僅異動檔案）
2. 讀取相關檔案內容
3. 了解專案架構和規範
4. 檢查相關 API 文件

### 2. 檢查階段
1. 逐一檢查每個檔案
2. 對照 CodingStyle 規範
3. 分析對現有系統的影響
4. 檢查商業邏輯正確性
5. 評估效能和安全性

### 3. 報告階段
1. 整理檢查結果
2. 列出發現的問題
3. 提供修改建議

## 檢查清單模板

### 檔案檢查清單
- **檔案名稱**: `app/Services/Example.php`
- **修改行數**: 第 100-150 行
- **CodingStyle**: ✅ 符合 / ⚠️ 需修正
- **API 影響**: ✅ 無影響 / ⚠️ 需注意
- **結構設計**: ✅ 良好 / ⚠️ 需改善
- **變數命名**: ✅ 符合規範 / ⚠️ 需修正
- **商業邏輯**: ✅ 正確 / ⚠️ 需修正
- **效能**: ✅ 良好 / ⚠️ 需優化
- **安全性**: ✅ 安全 / ⚠️ 需加強

### 問題記錄格式
**檔案**: `app/Services/Example.php`
**行數**: 第 120 行
**問題**: 變數命名不符合 camelCase 規範
**建議**: 將 `$user_name` 改為 `$userName`
**嚴重程度**: 低/中/高

## 報告格式

### 1. 標題結構
# [專案名稱] Code Review 報告

## 需求概述
[簡述此次修改的需求]

## 異動檔案清單
[列出所有修改的檔案]

## 檢查結果
[按檢查項目分類整理結果]

## 建議事項
[提供短期和長期建議]

## 總結
[整體評估和建議狀態]

### 2. 狀態標記
- ✅ **通過** - 符合規範，無需修改
- ⚠️ **需修正** - 有問題但可接受
- ❌ **需重做** - 有嚴重問題需重新實作

## 注意事項

### 1. 團隊慣例
- 尊重團隊現有的開發習慣
- 不強制修改符合團隊慣例的程式碼
- 優先考慮可維護性和一致性

### 2. 優先級處理
- 安全性問題優先處理
- 效能問題次之
- 程式碼風格最後處理

### 3. 建議原則
- 提供具體的修改建議
- 說明修改的原因和好處
- 考慮修改的成本和效益
