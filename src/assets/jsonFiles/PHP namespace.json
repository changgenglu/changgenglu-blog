{"name":"PHP namespace.md","content":"# PHP 命名空間\r\n\r\n> 參考資料：\r\n>\r\n> [namespace 命名空間詳解](https://learnku.com/articles/15064/namespace-namespace-detailed-explanation)\r\n\r\n## 什麼是命名空間\r\n\r\n在 php 中，語法規則不允許`變數`、`類別名稱`、`const 常數`在一個請求中出現多個相同的命名，若有應用程序不得不出現多個同名的`變數`、`類別名稱`、`const 常數`，此時可以將其放到不同的空間進行請求。\r\n\r\n這個不同的空間就稱作`命名空間 namespace`。空間可以作為一個`容器`、`儲存類別`、`函數`、`const 常數`的容器。\r\n\r\n- 同名元素在同一空間：\r\n\r\n  ```php\r\n  function getInfo(){\r\n    echo \"hello\";\r\n  }\r\n\r\n  function getInfo(){\r\n    echo \"hello\";\r\n  }\r\n  getInfo();\r\n  ```\r\n\r\n  同名稱的兩個 function 在同一個空間存取會報錯，錯誤碼：\r\n\r\n  ```txt\r\n  Fatal error: Cannot redeclare getInfo() (previously declared in...)\r\n  ```\r\n\r\n- 同名元素在不同空間\r\n\r\n  ```php\r\n  namespace Test1;\r\n\r\n  function getInfo() {\r\n    echo \"hello from test 1\";\r\n  }\r\n  getInfo();\r\n  echo \"<br>\";\r\n\r\n  namespace Test2;\r\n\r\n  function getInfo() {\r\n    echo \"hello from test 2\";\r\n  }\r\n  getInfo();\r\n  ```\r\n\r\n  相同命名的兩個 function 放到不同空間進行存取，最後輸出：\r\n\r\n  ```txt\r\n  hello from test 1\r\n  hello from test 2\r\n  ```\r\n\r\n## 使用命名空間\r\n\r\n### 命名規則\r\n\r\n- 透過 namespace 關鍵字宣告命名空間\r\n\r\n  ```php\r\n  namespace 空間名稱  // 空間名稱依照 php 正確的命名方式定義即可\r\n  ```\r\n\r\n  namespace 針對 function、類別名稱、const 常數三個部份起作用，並統稱為元素。\r\n\r\n### 常數的宣告\r\n\r\n- define ($name, $value);\r\n\r\n  在類別外部宣告常數，和命名空間沒有關係。同名稱的常數只能 define 一次\r\n\r\n  ```php\r\n  namespace Test1;\r\n  define ('IVAN', 'hello world');\r\n\r\n  namespace Test2;\r\n  define ('IVAN', 'hello world');\r\n\r\n  // Notice: Constants IVAN already defined in...\r\n  ```\r\n\r\n- const NAME = $value;\r\n  和空間命名有關係。const 可以在類別的內部宣告常數值(類別常數)，也可以在類別外部宣告(正常常數)。\r\n\r\n  使用空間命名的時候，const 可以放到類別外面宣告。相同名稱的多個常數，可以分別定義報不同的命名空間裡面。\r\n\r\n  ```php\r\n  namespace Test1;\r\n  const USER = \"ivan_1\";\r\n  echo USER;\r\n  echo \"<br>\";\r\n\r\n  namespace Test2;\r\n  const USER = \"ivan_2\";\r\n  echo USER;\r\n  ```\r\n\r\n  ```txt\r\n  ivan_1\r\n  ivan_2\r\n  ```\r\n\r\n### 命名空間中 const 和 define 的區別\r\n\r\n`const` 針對命名空間產生影響，`define` 不發生影響。\r\n\r\n`const` 可以宣告多個相同名稱的常數。\r\n\r\n`define` 宣告的名稱具有唯一性。\r\n\r\n## 間單的元素存取\r\n\r\n```php\r\n// 空間的名稱與具體父層目錄沒有直接關係\r\n// 按照 php 正確的命名方式定義即可\r\nnamespace Test1;\r\n\r\nfunction getInfo() {\r\n  echo \"test_1\";\r\n}\r\n\r\nconst USER = \"ivan_1\";\r\n\r\nnamespace Test2;\r\n\r\nfunction getInfo(){\r\n  echo \"test_2\";\r\n}\r\nconst USER = \"ivan_2\";\r\n\r\n// 存取元素\r\n// 當元素沒有任何限制的時候，會存取\"目前空間\"的元素\r\n// 目前空間：離此呼叫 function 最近的命名空間\r\ngetInfo(); // test_2\r\necho USER; // ivan_2\r\n\r\n// 當元素指定存取的命名空間\r\n// 存取其他命名空間的元素：\\空間\\元素;\r\n\\Test1\\getInfo(); // test_1\r\necho \\Test1\\USER; // ivan_1\r\n```\r\n\r\n## 子級(多級)空間\r\n\r\n命名空間可以讓我們存放許多元素(函數、類別、常數)，當元素較多時，為了方便管理，可以對元素進行分類儲存，將命名空間設定為多級空間。\r\n\r\n多級空間的最後一級空間就稱為子級空間。\r\n\r\n- 空間元素存取的三種型式：\r\n\r\n  - 非限定名稱方式\r\n  - 完全限定名稱方式\r\n  - 限定名稱\r\n\r\n- 多級命名空間使用\r\n\r\n  ```php\r\n  // 多級命名空間使用\r\n  namespace AAA\\aaa\\test;\r\n\r\n  class Shop\r\n  {\r\n    public $impression = 'beautiful';\r\n  }\r\n\r\n  namespace BBB\\bbb\\test;\r\n\r\n  class Shop\r\n  {\r\n    public $impression = 'science and technology';\r\n  }\r\n\r\n  // 非限定方式存取元素\r\n  // 預設存取當前的空間元素\r\n  $obj = new Shop();\r\n  echo $obj->impression; // science and technology\r\n\r\n  // 完全限定名稱方式存取元素\r\n  // 存取其他空間元素\r\n  $obj_1 = new \\AAA\\aaa\\test\\Shop();\r\n  echo $obj_1->impression; // beautiful\r\n  ```\r\n\r\n- 多級空間使用\r\n\r\n  ```php\r\n  namespace AAA\\aaa\\test\\library;\r\n  const USER = 'ivan_1';\r\n\r\n  namespace BBB\\bbb\\test;\r\n  const USER = \"ivan_2\";\r\n\r\n  namespace AAA\\aaa\\test;\r\n  const USER = \"ivan_3\";\r\n\r\n  // 限定名稱存取元素\r\n  // 此方法存取元素規則：目前空間 + 本身空間\\元素\r\n\r\n  echo library\\USER; // 命名空間為 \\AAA\\aaa\\test\\library\\USER;\r\n  // ivan_1\r\n  ```\r\n\r\n- 非限定名稱方式\r\n  `echo Shop::$impression;` 就近存取上面與其最近的空間內的 Shop() 元素。類似 php 引入文件 `include(\"common.php\");` 使用相對路徑引入當前目錄下的 common.php 文件。\r\n- 限定名稱\r\n  `echo library\\Shop::$impression;` 將當前空間和 library 空間聯合，獲得 Shop() 元素。類似 `include(\"Common/Conf/config.php\");` 相對路徑。\r\n- 完全限定名稱方式\r\n  `echo BBB\\Shop::$impression;` 存取 BBB 空間的 Shop 元素。類似 `include(\"D:/web/1121/Conf/common.php);` 使用絕對路徑引入文件。\r\n\r\n## 引入機制\r\n\r\n命名空間可宣告為多級空間，此一多級空間元素在其他的空間內部存取的時候，不可以需要透過`完全限定名稱`，此一方法不方便維護及開發。\r\n\r\n為了降低程式碼的複雜度，可以在當前的空間將指定的空間引入，進而透過`限定名稱`的形式，使用其他空間的元素。\r\n\r\n### 空間引入\r\n\r\n- use 空間\r\n\r\n  ```php\r\n  // 引入機制：空間引入\r\n  namespace AAA\\aaa\\test;\r\n\r\n  const USER = 'ivan';\r\n  const HOST = 'localhost:80';\r\n\r\n  function getInfo() {\r\n    echo 'test';\r\n  }\r\n\r\n  namespace BBB\\bbb\\library;\r\n\r\n  const USER = 'cindy';\r\n  const HOST = 'localhost:443';\r\n  function getInfo() {\r\n    echo 'test';\r\n  }\r\n\r\n  /**\r\n   * 項目需要頻繁存取其他空間元素\r\n   * 為了降低存取其他空間的複雜度，可以將頻繁存取的空間引入當前的空間\r\n   * 進而透過\"限定名稱\"方式存取元素\r\n   * 限定名稱：被引入間的最後一級空間的名稱\r\n   */\r\n\r\n  use AAA\\aaa\\test;\r\n\r\n  echo test\\USER; // ivan\r\n  test\\getInfo(); // test\r\n  echo test\\HOST; // localhost:80\r\n  // 返回最近的空間元素\r\n  echo USER; // cindy\r\n  ```\r\n\r\n- 類別元素引入：\r\n\r\n`use 空間\\空間\\空間\\類元素;`\r\n\r\n空間引入可以解決完全限定名稱訪問元素的繁瑣性，但是還需要透過限定名稱方式訪問空間。\r\n\r\n若引入空間的元素是 class，就可以直接將這個類別引入到當前空間，使用的時候也就可以透過非限定名稱的方式訪問。\r\n\r\n程式碼相對較為簡潔。\r\n\r\n- 類別元素引入\r\n\r\n  ```php\r\n  namespace AAA\\aaa\\test;\r\n\r\n  class Shop\r\n  {\r\n    static $name = 'ivan';\r\n  }\r\n\r\n  namespace BBB\\bbb\\test;\r\n  const USER = 'cindy';\r\n\r\n  // 將 AAA\\aaa\\test\\Shop 類別元素引入\r\n  use AAA\\aaa\\test\\Shop;\r\n\r\n  // 透過非限定名稱在此命名空間中存取引入的類別中的元素\r\n  echo Shop::$name; // ivan\r\n  ```\r\n\r\n- 類別元素在引入時的特殊狀況\r\n  當引入類別的命名和當前空間的類別名稱相同時：\r\n\r\n  ```php\r\n  namespace AAA\\aaa\\test;\r\n  class Shop\r\n  {\r\n    static $name = 'ivan';\r\n  }\r\n\r\n  namespace BBB\\bbb\\test;\r\n  const USER = 'cindy';\r\n  class Shop\r\n  {\r\n    static $name = 'jack';\r\n  }\r\n\r\n  // 將 AAA\\aaa\\test 類別元素直接引入\r\n  use AAA\\aaa\\test\\Shop;\r\n\r\n  // 透過非限定名稱存取引入的類別\r\n  echo Shop::$name; // error\r\n\r\n  // Fatal error: Cannot use AAA\\aaa\\test\\Shop as Shop because the name is already in use in...\r\n  ```\r\n\r\n  解決方法：使用別名\r\n\r\n  `use 空間\\元素 as 別名;`\r\n\r\n  把其他空間的一個類別元素引入到當前空間，若當前空間也已有一個同名的類別元素，則引入元素與當前空間的元素就會產生衝突，為了避免衝突，可以給引入的空間元素取一個別名。\r\n\r\n  引入的 Shop 與當前空間的 Shop 有衝突取別名：\r\n\r\n  ```php\r\n    namespace AAA\\aaa\\test;\r\n  class Shop\r\n  {\r\n    static $name = 'ivan';\r\n  }\r\n\r\n  namespace BBB\\bbb\\test;\r\n  const USER = 'cindy';\r\n  class Shop\r\n  {\r\n    static $name = 'jack';\r\n  }\r\n\r\n  // 將 AAA\\aaa\\test 類別元素直接引入\r\n  use AAA\\aaa\\test\\Shop as IntShop;\r\n\r\n  // 透過別名存取引入的類別\r\n  echo IntShop::$name; // ivan\r\n  echo Shop::$name; // jack\r\n  ```\r\n\r\n### 公共空間\r\n\r\n一個 php 文件裡面沒有 namespace 關鍵字宣告，則該文件的元素都存在於公共空間。\r\n\r\n存取公共空間的元素統一設為：`\\元素`\r\n\r\n### CommonSpace.php include 引入 CommonSpace1.php\r\n\r\n- CommonSpace.php\r\n\r\n  ```php\r\n  namespace AAA;\r\n\r\n  function f1() {\r\n    echo \"in good mood\";\r\n  }\r\n\r\n  // 在公共空間的檔案會被引入，針對當前空間不發生影想\r\n\r\n  include(\"CommonSpace1.php\"); // 公共空間\r\n\r\n  // 存取元素\r\n  f1(); // in good mood 當前空間就是 AAA 空間\r\n  echo \\NAME; // 存取公共空間的元素\r\n\r\n  // 本身有命名空間，引入的檔案是公共空間，本身的空間存取不到時，會到別的空間去尋找此元素\r\n  ```\r\n\r\n- CommonSpace1.php\r\n\r\n  ```php\r\n  const NAME = 'ivan';\r\n\r\n  function f1() {\r\n    echo \"okay\";\r\n  }\r\n\r\n  function f2() {\r\n    echo 'all good';\r\n  }\r\n  ```\r\n\r\nCommonSpace.php 有 namespace，CommonSpace1.php 沒有(CommonSpace1.php 處於公共空間)。被引入的檔案空間，此時被引入的文件 CommonSpace1.php 屬於公共空間，針對當前空間不發生影響。\r\n\r\n- 透過非限定名稱呼叫一個元素(function、常數)\r\n  - 首先取得本空間元素\r\n  - 其次取得公共空間元素\r\n\r\n若在 CommonSpace.php 中將 function fi() 註解，此時 f1() 呼叫的 function 為公共空間 function f1()，輸出：\r\n\r\n```txt\r\nokay\r\nivan\r\n```\r\n\r\n將 CommonSpace.php 的 function f1() 取消註解，此時 f1() 呼叫的是 AAA 命名空間的 function f1()。\r\n\r\n```txt\r\nin good mood\r\nivan\r\n```\r\n\r\n### ReverseCommonSpace.php include 引入 ReverseCommonSpace １.php\r\n\r\n- ReverseCommonSpace.php\r\n\r\n  ```php\r\n  function f1() {\r\n    echo \"in good mood\";\r\n  }\r\n\r\n  const NAME = \"cindy\";\r\n\r\n  function f2() {\r\n    echo \"good\";\r\n  }\r\n\r\n  include(\"ReverseCommonSpace1.php\") // 有命名空間\r\n\r\n  \\f2(); // good 存取公共空間需要有\"反斜線\"，提高程式碼可讀性\r\n  echo NAME;\r\n  echo \\AAA\\NAME;\r\n  // f3(); // 無法存取會報錯，正確的存取寫法為： \\AAA\\f3();\r\n  \\AAA\\f3();\r\n\r\n  // 本身是公共空間，引入的檔案是有命名空間的，本身的空間無法存取時，不會到別的空間去找尋元素。\r\n  ```\r\n\r\n  若 f3(); 沒有註解掉會報錯：\r\n\r\n  ```txt\r\n  good\r\n  cindy\r\n  ivan\r\n\r\n  (!) Fatal error: Uncaught Error: Call to undefined function f3() in...\r\n  ```\r\n\r\n  將其註解後輸出：\r\n\r\n  ```txt\r\n  good\r\n  cindy\r\n  ivan\r\n  buy book\r\n  ```\r\n\r\n- ReverseCommonSpace1.php\r\n\r\n  ```php\r\n  namespace AAA;\r\n\r\n  const NAME = 'ivan';\r\n\r\n  function f2() {\r\n    echo 'good';\r\n  }\r\n\r\n  function f3(){\r\n    echo \"buy book\";\r\n  }\r\n  ```\r\n\r\n## 範例與總結\r\n\r\n### 錯誤範例\r\n\r\n```php\r\nconst USER = 'ivan';\r\n\r\nnamespace AAA;\r\n\r\nfunction getInfo() {\r\n  echo 'OK';\r\n}\r\n\r\n// Fatal error: Namespace declaration statement has to be the very first statement or after any declare call in the script in...\r\n```\r\n\r\n正確做法：\r\n\r\n```php\r\nnamespace AAA;\r\n\r\nconst USER = 'ivan';\r\n\r\nfunction getInfo() {\r\n  echo 'OK';\r\n}\r\n\r\ngetInfo(); // OK\r\n```\r\n\r\n不能宣告常數在公共空間，而 function 在命名空間。\r\n\r\n宣告命名空間時，在 namespace 關鍵字前面不能有任何程式碼，包刮 header 也要寫在下面。\r\n\r\n### 命名空間總結\r\n\r\n1. 宣告命名空間時，在 namespace 關鍵字前面不能有任何程式碼(可以註解)，包刮 header 也要寫在下面。\r\n2. 命名空間是虛擬抽象的空間，非真實的檔案路徑。\r\n3. 同一請求多檔案可以使用相同的命名空間，只要這些檔案中不會出現多的同名稱、同類型的元素(function, const)即可。\r\n","tocContent":""}