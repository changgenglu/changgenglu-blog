{"name":"Laravel HTTP Client.md","content":"# laravel HTTP Client\r\n\r\n> laravel 透過 Guzzle 這個套件，模擬 http client 來發送 request\r\n> 預設情況下，laravel 已經自動包含了這個套件。\r\n> 若尚未安裝，可透過 composer 再安裝一次。\r\n>\r\n> ```bash\r\n> composer require guzzlehttp/guzzle\r\n> ```\r\n\r\n## 建立 request\r\n\r\n建立基礎的 GET request\r\n\r\n```php\r\nuse Illuminate\\Support\\Facades\\Http;\r\n\r\n$response = Http::get('http://example.com');\r\n```\r\n\r\n可以直接將查詢字串(query string)加到 URL 上，或是傳入一組索引鍵/值配對的陣列作為 get 的第二個引數\r\n\r\n```php\r\n$response = Http::get('http://example.com/users', [\r\n    'name' => 'Taylor',\r\n    'page' => 1,\r\n]);\r\n```\r\n\r\nget 方法會回傳 Illuminate\\Http\\Client\\Response 的實體，該實體提供了許多用來取得 Response 資訊的方法：\r\n\r\n```php\r\n$response->body() : string;\r\n$response->json($key = null) : array|mixed;\r\n$response->object() : object;\r\n$response->collect($key = null) : Illuminate\\Support\\Collection;\r\n$response->status() : int;\r\n$response->ok() : bool;\r\n$response->successful() : bool;\r\n$response->redirect(): bool;\r\n$response->failed() : bool;\r\n$response->serverError() : bool;\r\n$response->clientError() : bool;\r\n$response->header($header) : string;\r\n$response->headers() : array;\r\n```\r\n\r\nPOST PUT PATCH 等 HTTP action 傳送額外資料，一般情況下，資料會使用 json 的資料型別來傳遞\r\n\r\n```php\r\nuse Illuminate\\Support\\Facades\\Http;\r\n\r\n$response = Http::post('http://example.com/users', [\r\n    'name' => 'Steve',\r\n    'role' => 'Network Administrator',\r\n]);\r\n```\r\n\r\n若想用 x-www-form-urlencoded 來傳送資料，要在建立 request 前呼叫 asForm() 方法\r\n\r\n```php\r\n$response = Http::asForm()->post('http://example.com/users', [\r\n    'name' => 'Sara',\r\n    'role' => 'Privacy Consultant',\r\n]);\r\n```\r\n\r\n## 錯誤處理\r\n\r\nlaravel HTTP client 不會在 client 端或是 server 端錯誤時拋出異常(status code 400 or 500)。\r\n\r\n此時可以透過 successful, clientError 或是 serverError 方法來判斷是否發生錯誤。\r\n\r\n```php\r\n// 若 status code 在200 ~ 300\r\n$response->successful();\r\n\r\n// 若 status code 大於 400\r\n$response->failed();\r\n\r\n// 若 status code 為400層級的錯誤\r\n$response->clientError();\r\n\r\n// 若 status code 為500層級的錯誤\r\n$response->serverError();\r\n```\r\n","tocContent":""}