{"name":"Laravel 資料庫設計範例.md","content":"# Laravel 資料庫設計範例\n\n## 建立新專案\n\n```cmd\nlaravel new blog\n```\n\n## 編輯 .env\n\n```php\nDB_CONNECTION=mysql\nDB_HOST=127.0.0.1\nDB_PORT=3306\nDB_DATABASE=your_database\nDB_USERNAME=your_name\nDB_PASSWORD=your_password\n```\n\n- XAMPP 預設的密碼是空白，phpEnv 要先行設定資料庫密碼\n\n## 同時建立 migration controller model\n\n終端機執行\n\n```cmd\nphp artisan make:model Employee -mcr\n```\n\n完成後產生三個檔案\n\n- database\\migrations\\yyyy_mm_dd_time_create_employees_table.php\n- app\\Http\\Controllers\\EmployeeController.php\n- app\\Models\\Employee.php\n\n修改 migration 檔案，將 up() 函式改成\n\n```php\npublic function up()\n{\n    Schema::create('employees', function (Blueprint $table) {\n        $table->bigIncrements('id');\n        $table->string('firstName');\n        $table->string('lastName');\n        $table->timestamps();\n    });\n}\n```\n\n執行 migrate ，在資料庫中建立資料表\n\n```cmd\nphp artisan migrate\n```\n\n## 建立資料\n\n終端機開啟 tinker 工具程式\n\n```cmd\nphp artisan tinker\n```\n\n依序輸入指令\n\n```cmd\n1 + 2\nDB::table('employees')->insert(['firstName' => 'Jeremy', 'lastName' => 'Lin', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\nDB::table('employees')->insert(['firstName' => 'Derek', 'lastName' => 'Jeter', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\nDB::table('employees')->insert(['firstName' => 'Lionel', 'lastName' => 'Messi', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\nDB::table('employees')->insert(['firstName' => 'test', 'lastName' => 'test', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\n\nDB::table('employees')->get();\nDB::table('employees')->find(1)\nDB::table('employees')->where('lastName', 'test')->first()\nDB::table('employees')->where('lastName', 'test')->delete()\n\nApp\\Models\\Employee::all();\nApp\\Models\\Employee::find(1);\n\nexit\n```\n\n## 渲染員工清單\n\n編輯 web.php\n\n```php\nRoute::get('/', 'App\\Http\\Controllers\\EmployeeController@index');\nRoute::resource('employees', 'App\\Http\\Controllers\\EmployeeController');\n```\n\n編輯 EmployeesController，需參用 Employee 類別\n\n```php\nuse App\\Models\\Employee;\n```\n\n修改 index()\n\n```php\npublic function index() {\n        $employeeList = Employee::all();\n        return view('employees.index', compact('employeeList'));\n    }\n```\n\n建立 resources\\views\\employees\\index.blade.php\n\n```php\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <title>Employee</title>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\n  <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\n</head>\n<body>\n\n<div class=\"container\">\n  <h2>Employee List\n    <a href=\"/employees/create\" class=\"btn btn-md btn-success pull-right\">\n      <span class=\"glyphicon glyphicon-plus\"></span> 新增\n    </a>\n  </h2>\n  <table class=\"table table-hover\">\n    <thead>\n      <tr>\n        <th>Firstname</th>\n        <th>Lastname</th>\n        <th>&nbsp;</th>\n      </tr>\n    </thead>\n    <tbody>\n    <tr>\n        <td>firstName1</td>\n        <td>lastName1</td>\n        <td>\n            <span class=\"pull-right\">\n                <form method=\"post\" action=\"/employees/1\">\n                    <a href=\"/employees/1/edit\" class=\"btn btn-xs btn-info\">\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\n              </a> |\n                    @csrf\n                    @method('DELETE')\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\n              </button>\n                </form>\n            </span>\n        </td>\n    </tr>\n    <tr>\n        <td>firstName2</td>\n        <td>lastName2</td>\n        <td>\n            <span class=\"pull-right\">\n                <form method=\"post\" action=\"/employees/2\">\n                    <a href=\"/employees/2/edit\" class=\"btn btn-xs btn-info\">\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\n              </a> |\n                    @csrf\n                    @method('DELETE')\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\n              </button>\n                </form>\n            </span>\n        </td>\n    </tr>\n    <tr>\n        <td>firstName3</td>\n        <td>lastName3</td>\n        <td>\n            <span class=\"pull-right\">\n                <form method=\"post\" action=\"/employees/3\">\n                    <a href=\"/employees/3/edit\" class=\"btn btn-xs btn-info\">\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\n              </a> |\n                    @csrf\n                    @method('DELETE')\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\n              </button>\n                </form>\n            </span>\n        </td>\n    </tr>\n    </tbody>\n  </table>\n</div>\n</body>\n</html>\n```\n\n啟動 Web 伺服器\n\n```cmd\nphp artisan serve\n```\n\n## 動態渲染員工資料\n\n修改 resources\\views\\employees\\index.blade.php\n\n```php\n<tbody>\n    @foreach ($employeeList as $emp)\n     <tr>\n         <td>{{$emp->firstName}}</td>\n         <td>{{$emp->lastName}}</td>\n         <td>\n             <span class=\"pull-right\">\n                 <form method=\"post\" action=\"/employees/{{$emp->id}}\">\n                     <a href=\"/employees/{{$emp->id}}/edit\" class=\"btn btn-xs btn-info\">\n          <span class=\"glyphicon glyphicon-pencil\"></span> 修改\n         </a> |\n                     @csrf\n                     @method('DELETE')\n                     <button type=\"submit\" class=\"btn btn-xs btn-danger\">\n          <span class=\"glyphicon glyphicon-remove\"></span> 刪除\n         </button>\n                  </form>\n             </span>\n         </td>\n     </tr>\n    @endforeach\n</tbody>\n```\n\n## 新增員工資料\n\n修改 EmployeesController.php\n\n```php\npublic function create()\n    {\n        return view(\"employees.create\");\n    }\n```\n\n新增檔案 resources\\views\\employees\\create.blade.php\n\n```php\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <title>Employee</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\n</head>\n\n<body>\n    <div class=\"container\">\n        <form class=\"form-horizontal\">\n     @csrf\n            <fieldset>\n                <!-- Form Name -->\n                <legend>Employee Data</legend>\n                <!-- Text input-->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"firstName\">First Name:</label>\n                    <div class=\"col-md-4\">\n                        <input id=\"firstName\" name=\"firstName\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\n                    </div>\n                </div>\n                <!-- Text input-->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"lastName\">Last Name:</label>\n                    <div class=\"col-md-4\">\n                        <input id=\"lastName\" name=\"lastName\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\n                    </div>\n                </div>\n                <!-- Button (Double) -->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"okOrCancel\"></label>\n                    <div class=\"col-md-8\">\n                        <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-success\">\n                         OK\n                        </button>\n         <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-danger\">\n                         Cancel\n                        </button>\n                    </div>\n                </div>\n            </fieldset>\n        </form>\n    </div>\n</body>\n</html>\n```\n\n修改 EmployeesController.php\n\n```php\npublic function store(Request $request)\n    {\n        $emp = new Employee();\n        $emp->firstName = $request->firstName;\n        $emp->lastName = $request->lastName;\n        $emp->save();\n        return redirect(\"/employees\");\n    }\n```\n\n## 修改會員資料\n\n修改 EmployeesController.php\n\n```php\npublic function edit($id)\n    {\n        $emp = Employee::find($id);\n        return view('employees.edit', compact('emp'));\n    }\n```\n\n新增檔案 resources\\views\\employees\\edit.blade.php\n\n```php\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <title>Employee</title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\n</head>\n\n<body>\n    <div class=\"container\">\n        <form class=\"form-horizontal\">\n     @csrf\n  @method('PUT')\n            <fieldset>\n                <!-- Form Name -->\n                <legend>Employee Data</legend>\n                <!-- Text input-->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"firstName\">First Name:</label>\n                    <div class=\"col-md-4\">\n                        <input id=\"firstName\" name=\"firstName\" value=\"{{ $emp->firstName }}\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\n                    </div>\n                </div>\n                <!-- Text input-->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"lastName\">Last Name:</label>\n                    <div class=\"col-md-4\">\n                        <input id=\"firstName\" name=\"firstName\" value=\"{{ $emp->lastName }}\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\n                    </div>\n                </div>\n                <!-- Button (Double) -->\n                <div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\" for=\"okOrCancel\"></label>\n                    <div class=\"col-md-8\">\n                     <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-success\">\n                         OK\n                        </button>\n         <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-danger\">\n                         Cancel\n                        </button>\n                    </div>\n                </div>\n            </fieldset>\n        </form>\n    </div>\n</body>\n</html>\n```\n\n修改 EmployeesController.php\n\n```php\npublic function update(Request $request, $id)\n    {\n        $emp = Employee::find($id);\n        $emp->firstName = $request->firstName;\n        $emp->lastName = $request->lastName;\n        $emp->save();\n        return redirect(\"/employees\");\n    }\n```\n\n## 刪除會員資料\n\n修改 EmployeesController.php\n\n```php\npublic function destroy($id)\n    {\n        $emp = Employee::find($id);\n        $emp->delete();\n        return redirect(\"/employees\");\n    }\n```\n","tocContent":""}