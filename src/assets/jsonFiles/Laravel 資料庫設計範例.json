{"name":"Laravel 資料庫設計範例.md","content":"# Laravel 資料庫設計範例\r\n\r\n## 建立新專案\r\n\r\n```cmd\r\nlaravel new blog\r\n```\r\n\r\n## 編輯 .env\r\n\r\n```php\r\nDB_CONNECTION=mysql\r\nDB_HOST=127.0.0.1\r\nDB_PORT=3306\r\nDB_DATABASE=your_database\r\nDB_USERNAME=your_name\r\nDB_PASSWORD=your_password\r\n```\r\n\r\n- XAMPP 預設的密碼是空白，phpEnv 要先行設定資料庫密碼\r\n\r\n## 同時建立 migration controller model\r\n\r\n終端機執行\r\n\r\n```cmd\r\nphp artisan make:model Employee -mcr\r\n```\r\n\r\n完成後產生三個檔案\r\n\r\n- database\\migrations\\yyyy_mm_dd_time_create_employees_table.php\r\n- app\\Http\\Controllers\\EmployeeController.php\r\n- app\\Models\\Employee.php\r\n\r\n修改 migration 檔案，將 up() 函式改成\r\n\r\n```php\r\npublic function up()\r\n{\r\n    Schema::create('employees', function (Blueprint $table) {\r\n        $table->bigIncrements('id');\r\n        $table->string('firstName');\r\n        $table->string('lastName');\r\n        $table->timestamps();\r\n    });\r\n}\r\n```\r\n\r\n執行 migrate ，在資料庫中建立資料表\r\n\r\n```cmd\r\nphp artisan migrate\r\n```\r\n\r\n## 建立資料\r\n\r\n終端機開啟 tinker 工具程式\r\n\r\n```cmd\r\nphp artisan tinker\r\n```\r\n\r\n依序輸入指令\r\n\r\n```cmd\r\n1 + 2\r\nDB::table('employees')->insert(['firstName' => 'Jeremy', 'lastName' => 'Lin', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\r\nDB::table('employees')->insert(['firstName' => 'Derek', 'lastName' => 'Jeter', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\r\nDB::table('employees')->insert(['firstName' => 'Lionel', 'lastName' => 'Messi', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\r\nDB::table('employees')->insert(['firstName' => 'test', 'lastName' => 'test', 'created_at' => new Datetime, 'updated_at' => new Datetime ])\r\n\r\nDB::table('employees')->get();\r\nDB::table('employees')->find(1)\r\nDB::table('employees')->where('lastName', 'test')->first()\r\nDB::table('employees')->where('lastName', 'test')->delete()\r\n\r\nApp\\Models\\Employee::all();\r\nApp\\Models\\Employee::find(1);\r\n\r\nexit\r\n```\r\n\r\n## 渲染員工清單\r\n\r\n編輯 web.php\r\n\r\n```php\r\nRoute::get('/', 'App\\Http\\Controllers\\EmployeeController@index');\r\nRoute::resource('employees', 'App\\Http\\Controllers\\EmployeeController');\r\n```\r\n\r\n編輯 EmployeesController，需參用 Employee 類別\r\n\r\n```php\r\nuse App\\Models\\Employee;\r\n```\r\n\r\n修改 index()\r\n\r\n```php\r\npublic function index() {\r\n        $employeeList = Employee::all();\r\n        return view('employees.index', compact('employeeList'));\r\n    }\r\n```\r\n\r\n建立 resources\\views\\employees\\index.blade.php\r\n\r\n```php\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <title>Employee</title>\r\n  <meta charset=\"utf-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n  <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\r\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\r\n  <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\r\n</head>\r\n<body>\r\n\r\n<div class=\"container\">\r\n  <h2>Employee List\r\n    <a href=\"/employees/create\" class=\"btn btn-md btn-success pull-right\">\r\n      <span class=\"glyphicon glyphicon-plus\"></span> 新增\r\n    </a>\r\n  </h2>\r\n  <table class=\"table table-hover\">\r\n    <thead>\r\n      <tr>\r\n        <th>Firstname</th>\r\n        <th>Lastname</th>\r\n        <th>&nbsp;</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n    <tr>\r\n        <td>firstName1</td>\r\n        <td>lastName1</td>\r\n        <td>\r\n            <span class=\"pull-right\">\r\n                <form method=\"post\" action=\"/employees/1\">\r\n                    <a href=\"/employees/1/edit\" class=\"btn btn-xs btn-info\">\r\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\r\n              </a> |\r\n                    @csrf\r\n                    @method('DELETE')\r\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\r\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\r\n              </button>\r\n                </form>\r\n            </span>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>firstName2</td>\r\n        <td>lastName2</td>\r\n        <td>\r\n            <span class=\"pull-right\">\r\n                <form method=\"post\" action=\"/employees/2\">\r\n                    <a href=\"/employees/2/edit\" class=\"btn btn-xs btn-info\">\r\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\r\n              </a> |\r\n                    @csrf\r\n                    @method('DELETE')\r\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\r\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\r\n              </button>\r\n                </form>\r\n            </span>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>firstName3</td>\r\n        <td>lastName3</td>\r\n        <td>\r\n            <span class=\"pull-right\">\r\n                <form method=\"post\" action=\"/employees/3\">\r\n                    <a href=\"/employees/3/edit\" class=\"btn btn-xs btn-info\">\r\n               <span class=\"glyphicon glyphicon-pencil\"></span> 修改\r\n              </a> |\r\n                    @csrf\r\n                    @method('DELETE')\r\n                    <button type=\"submit\" class=\"btn btn-xs btn-danger\">\r\n               <span class=\"glyphicon glyphicon-remove\"></span> 刪除\r\n              </button>\r\n                </form>\r\n            </span>\r\n        </td>\r\n    </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n</body>\r\n</html>\r\n```\r\n\r\n啟動 Web 伺服器\r\n\r\n```cmd\r\nphp artisan serve\r\n```\r\n\r\n## 動態渲染員工資料\r\n\r\n修改 resources\\views\\employees\\index.blade.php\r\n\r\n```php\r\n<tbody>\r\n    @foreach ($employeeList as $emp)\r\n     <tr>\r\n         <td>{{$emp->firstName}}</td>\r\n         <td>{{$emp->lastName}}</td>\r\n         <td>\r\n             <span class=\"pull-right\">\r\n                 <form method=\"post\" action=\"/employees/{{$emp->id}}\">\r\n                     <a href=\"/employees/{{$emp->id}}/edit\" class=\"btn btn-xs btn-info\">\r\n          <span class=\"glyphicon glyphicon-pencil\"></span> 修改\r\n         </a> |\r\n                     @csrf\r\n                     @method('DELETE')\r\n                     <button type=\"submit\" class=\"btn btn-xs btn-danger\">\r\n          <span class=\"glyphicon glyphicon-remove\"></span> 刪除\r\n         </button>\r\n                  </form>\r\n             </span>\r\n         </td>\r\n     </tr>\r\n    @endforeach\r\n</tbody>\r\n```\r\n\r\n## 新增員工資料\r\n\r\n修改 EmployeesController.php\r\n\r\n```php\r\npublic function create()\r\n    {\r\n        return view(\"employees.create\");\r\n    }\r\n```\r\n\r\n新增檔案 resources\\views\\employees\\create.blade.php\r\n\r\n```php\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <title>Employee</title>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\r\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\r\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"container\">\r\n        <form class=\"form-horizontal\">\r\n     @csrf\r\n            <fieldset>\r\n                <!-- Form Name -->\r\n                <legend>Employee Data</legend>\r\n                <!-- Text input-->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"firstName\">First Name:</label>\r\n                    <div class=\"col-md-4\">\r\n                        <input id=\"firstName\" name=\"firstName\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\r\n                    </div>\r\n                </div>\r\n                <!-- Text input-->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"lastName\">Last Name:</label>\r\n                    <div class=\"col-md-4\">\r\n                        <input id=\"lastName\" name=\"lastName\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\r\n                    </div>\r\n                </div>\r\n                <!-- Button (Double) -->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"okOrCancel\"></label>\r\n                    <div class=\"col-md-8\">\r\n                        <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-success\">\r\n                         OK\r\n                        </button>\r\n         <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-danger\">\r\n                         Cancel\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </fieldset>\r\n        </form>\r\n    </div>\r\n</body>\r\n</html>\r\n```\r\n\r\n修改 EmployeesController.php\r\n\r\n```php\r\npublic function store(Request $request)\r\n    {\r\n        $emp = new Employee();\r\n        $emp->firstName = $request->firstName;\r\n        $emp->lastName = $request->lastName;\r\n        $emp->save();\r\n        return redirect(\"/employees\");\r\n    }\r\n```\r\n\r\n## 修改會員資料\r\n\r\n修改 EmployeesController.php\r\n\r\n```php\r\npublic function edit($id)\r\n    {\r\n        $emp = Employee::find($id);\r\n        return view('employees.edit', compact('emp'));\r\n    }\r\n```\r\n\r\n新增檔案 resources\\views\\employees\\edit.blade.php\r\n\r\n```php\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <title>Employee</title>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css\">\r\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\r\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js\"></script>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"container\">\r\n        <form class=\"form-horizontal\">\r\n     @csrf\r\n  @method('PUT')\r\n            <fieldset>\r\n                <!-- Form Name -->\r\n                <legend>Employee Data</legend>\r\n                <!-- Text input-->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"firstName\">First Name:</label>\r\n                    <div class=\"col-md-4\">\r\n                        <input id=\"firstName\" name=\"firstName\" value=\"{{ $emp->firstName }}\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\r\n                    </div>\r\n                </div>\r\n                <!-- Text input-->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"lastName\">Last Name:</label>\r\n                    <div class=\"col-md-4\">\r\n                        <input id=\"firstName\" name=\"firstName\" value=\"{{ $emp->lastName }}\" type=\"text\" placeholder=\"\" class=\"form-control input-md\">\r\n                    </div>\r\n                </div>\r\n                <!-- Button (Double) -->\r\n                <div class=\"form-group\">\r\n                    <label class=\"col-md-4 control-label\" for=\"okOrCancel\"></label>\r\n                    <div class=\"col-md-8\">\r\n                     <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-success\">\r\n                         OK\r\n                        </button>\r\n         <button type=\"submit\" id=\"okOrCancel\" name=\"okOrCancel\" class=\"btn btn-danger\">\r\n                         Cancel\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </fieldset>\r\n        </form>\r\n    </div>\r\n</body>\r\n</html>\r\n```\r\n\r\n修改 EmployeesController.php\r\n\r\n```php\r\npublic function update(Request $request, $id)\r\n    {\r\n        $emp = Employee::find($id);\r\n        $emp->firstName = $request->firstName;\r\n        $emp->lastName = $request->lastName;\r\n        $emp->save();\r\n        return redirect(\"/employees\");\r\n    }\r\n```\r\n\r\n## 刪除會員資料\r\n\r\n修改 EmployeesController.php\r\n\r\n```php\r\npublic function destroy($id)\r\n    {\r\n        $emp = Employee::find($id);\r\n        $emp->delete();\r\n        return redirect(\"/employees\");\r\n    }\r\n```\r\n","tocContent":""}