{"name":"Curl 學習筆記.md","content":"# curl 命令完整說明手冊\n\n## 目錄\n1. [基本概念](#基本概念)\n2. [HTTP 方法](#http-方法)\n3. [常用選項](#常用選項)\n4. [實際範例](#實際範例)\n5. [進階功能](#進階功能)\n6. [故障排除](#故障排除)\n7. [最佳實踐](#最佳實踐)\n\n## 基本概念\n\ncurl 是一個強大的命令列工具，用於傳輸資料到或從伺服器。它支援多種協定，包括 HTTP、HTTPS、FTP、FTPS、SCP、SFTP 等。\n\n### 基本語法\n```bash\ncurl [選項] [URL]\n```\n\n## HTTP 方法\n\n### GET 請求\nGET 方法用於從伺服器取得資料，這是預設的 HTTP 方法。\n\n#### 基本 GET 請求\n```bash\ncurl \"https://test.com/api/users\"\n```\n\n#### 帶查詢參數的 GET 請求\n```bash\ncurl \"https://test.com/api/users?page=1&limit=10&status=active\"\n```\n\n#### 帶自訂標頭的 GET 請求\n```bash\ncurl -H \"Authorization: Bearer YOUR_TOKEN\" \\\n     -H \"Accept: application/json\" \\\n     \"https://test.com/api/users\"\n```\n\n### POST 請求\nPOST 方法用於向伺服器提交資料。\n\n#### 基本 POST 請求 (表單資料)\n```bash\ncurl -X POST \"https://test.com/api/login\" \\\n  -H \"Content-Type: application/x-www-form-urlencoded\" \\\n  -d \"username=YOUR_USERNAME&password=YOUR_PASSWORD\"\n```\n\n#### JSON 資料 POST 請求\n```bash\ncurl -X POST \"https://test.com/api/users\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\":\"張三\",\"email\":\"zhang@example.com\",\"age\":25}'\n```\n\n#### 從檔案讀取 JSON 資料\n```bash\ncurl -X POST \"https://test.com/api/users\" \\\n  -H \"Content-Type: application/json\" \\\n  -d @user_data.json\n```\n\n#### 上傳檔案\n```bash\ncurl -X POST \"https://test.com/api/upload\" \\\n  -F \"file=@/path/to/file.jpg\" \\\n  -F \"description=圖片描述\"\n```\n\n### PUT 請求\nPUT 方法用於更新或建立資源。\n\n#### 更新使用者資料\n```bash\ncurl -X PUT \"https://test.com/api/users/123\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\" \\\n  -d '{\"name\":\"李四\",\"email\":\"li@example.com\",\"age\":30}'\n```\n\n#### 完整替換資源\n```bash\ncurl -X PUT \"https://test.com/api/articles/456\" \\\n  -H \"Content-Type: application/json\" \\\n  -d @article_data.json\n```\n\n### PATCH 請求\nPATCH 方法用於部分更新資源。\n\n#### 部分更新使用者資料\n```bash\ncurl -X PATCH \"https://test.com/api/users/123\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\" \\\n  -d '{\"email\":\"newemail@example.com\"}'\n```\n\n### DELETE 請求\nDELETE 方法用於刪除資源。\n\n#### 刪除使用者\n```bash\ncurl -X DELETE \"https://test.com/api/users/123\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\"\n```\n\n#### 帶確認的刪除請求\n```bash\ncurl -X DELETE \"https://test.com/api/users/123\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\" \\\n  -H \"X-Confirm-Delete: true\"\n```\n\n### HEAD 請求\nHEAD 方法用於取得回應標頭，不包含回應主體。\n\n```bash\ncurl -I \"https://test.com/api/users\"\n```\n\n### OPTIONS 請求\nOPTIONS 方法用於查詢伺服器支援的方法。\n\n```bash\ncurl -X OPTIONS \"https://test.com/api/users\" \\\n  -H \"Access-Control-Request-Method: POST\" \\\n  -H \"Access-Control-Request-Headers: Content-Type\"\n```\n\n## 常用選項\n\n### 基本選項\n- `-X, --request <method>` - 指定 HTTP 方法 (GET, POST, PUT, DELETE 等)\n- `-H, --header <header>` - 設定 HTTP 標頭\n- `-d, --data <data>` - 設定 POST 資料\n- `-F, --form <name=content>` - 設定表單資料 (multipart/form-data)\n- `-G, --get` - 將資料作為查詢參數發送\n- `-b, --cookie <data>` - 設定 Cookie\n- `-c, --cookie-jar <file>` - 儲存 Cookie 到檔案\n- `-u, --user <user:password>` - 基本認證\n- `-o, --output <file>` - 輸出到檔案\n- `-O, --remote-name` - 使用遠端檔案名稱\n- `-s, --silent` - 靜默模式\n- `-v, --verbose` - 詳細輸出\n- `-i, --include` - 包含回應標頭\n- `-I, --head` - 只取得標頭\n- `-L, --location` - 跟隨重定向\n- `-k, --insecure` - 忽略 SSL 憑證錯誤\n- `-w, --write-out <format>` - 格式化輸出\n- `--connect-timeout <seconds>` - 連線超時\n- `--max-time <seconds>` - 最大執行時間\n- `--retry <num>` - 重試次數\n- `--retry-delay <seconds>` - 重試間隔\n\n### 進階選項\n- `--compressed` - 請求壓縮回應\n- `--keepalive-time <seconds>` - Keep-Alive 時間\n- `--max-redirs <num>` - 最大重定向次數\n- `--proxy <proxy>` - 使用代理伺服器\n- `--resolve <host:port:address>` - 自訂 DNS 解析\n- `--cacert <file>` - CA 憑證檔案\n- `--cert <file>` - 用戶端憑證\n- `--key <file>` - 私鑰檔案\n\n## 實際範例\n\n### 認證相關\n\n#### 基本認證\n```bash\ncurl -u \"username:password\" \"https://test.com/api/protected\"\n```\n\n#### Bearer Token 認證\n```bash\ncurl -H \"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...\" \\\n     \"https://test.com/api/protected\"\n```\n\n#### API Key 認證\n```bash\ncurl -H \"X-API-Key: your-api-key-here\" \\\n     \"https://test.com/api/data\"\n```\n\n### 檔案操作\n\n#### 下載檔案\n```bash\ncurl -O \"https://test.com/files/document.pdf\"\n```\n\n#### 下載並重新命名\n```bash\ncurl -o \"my_document.pdf\" \"https://test.com/files/document.pdf\"\n```\n\n#### 上傳檔案\n```bash\ncurl -X POST \"https://test.com/api/upload\" \\\n  -F \"file=@/path/to/file.jpg\" \\\n  -F \"title=我的圖片\"\n```\n\n#### 多檔案上傳\n```bash\ncurl -X POST \"https://test.com/api/upload\" \\\n  -F \"files[]=@file1.jpg\" \\\n  -F \"files[]=@file2.jpg\" \\\n  -F \"files[]=@file3.jpg\"\n```\n\n### 會話管理\n\n#### 登入並儲存 Cookie\n```bash\ncurl -c cookies.txt -X POST \"https://test.com/api/login\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"user\",\"password\":\"pass\"}'\n```\n\n#### 使用儲存的 Cookie\n```bash\ncurl -b cookies.txt \"https://test.com/api/protected\"\n```\n\n### 效能測試\n\n#### 測試連線速度\n```bash\ncurl -w \"\\n\\n=== 效能統計 ===\\nHTTP 狀態碼: %{http_code}\\n總耗時: %{time_total}s\\n連線耗時: %{time_connect}s\\nDNS 解析: %{time_namelookup}s\\nSSL 握手: %{time_appconnect}s\\n重定向: %{time_redirect}s\\n開始傳輸: %{time_pretransfer}s\\n首字節: %{time_starttransfer}s\\n\" \\\n     -s -o /dev/null \"https://test.com/api/test\"\n```\n\n#### 壓力測試\n```bash\n# 測試 10 次請求\nfor i in {1..10}; do\n  echo \"請求 $i:\"\n  curl -w \"耗時: %{time_total}s\\n\" \\\n       -s -o /dev/null \"https://test.com/api/test\"\ndone\n```\n\n### 除錯和監控\n\n#### 詳細輸出\n```bash\ncurl -v \"https://test.com/api/users\"\n```\n\n#### 只顯示標頭\n```bash\ncurl -I \"https://test.com/api/users\"\n```\n\n#### 儲存完整回應\n```bash\ncurl -D headers.txt -o response.json \"https://test.com/api/users\"\n```\n\n## 進階功能\n\n### 環境變數使用\n```bash\n# 設定環境變數\nexport API_BASE_URL=\"https://test.com/api\"\nexport API_TOKEN=\"your-token-here\"\n\n# 使用環境變數\ncurl -H \"Authorization: Bearer $API_TOKEN\" \\\n     \"$API_BASE_URL/users\"\n```\n\n### 批次處理\n```bash\n# 從檔案讀取 URL 列表\nwhile read url; do\n  echo \"測試: $url\"\n  curl -w \"狀態: %{http_code}, 耗時: %{time_total}s\\n\" \\\n       -s -o /dev/null \"$url\"\ndone < urls.txt\n```\n\n### 條件請求\n```bash\n# 使用 If-Modified-Since\ncurl -H \"If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT\" \\\n     \"https://test.com/api/data\"\n\n# 使用 If-None-Match\ncurl -H \"If-None-Match: \\\"abc123\\\"\" \\\n     \"https://test.com/api/data\"\n```\n\n### 自訂 DNS 解析\n```bash\ncurl --resolve \"test.com:443:192.168.1.100\" \\\n     \"https://test.com/api/test\"\n```\n\n### 代理設定\n```bash\n# HTTP 代理\ncurl --proxy \"http://proxy.example.com:8080\" \\\n     \"https://test.com/api/data\"\n\n# SOCKS 代理\ncurl --socks5 \"127.0.0.1:1080\" \\\n     \"https://test.com/api/data\"\n```\n\n## 故障排除\n\n### 常見錯誤\n\n#### 1. 連線錯誤\n```bash\n# 錯誤: curl: (7) Failed to connect to test.com port 443: Connection refused\n# 解決: 檢查網路連線和防火牆設定\ncurl --connect-timeout 10 \"https://test.com/api/test\"\n```\n\n#### 2. SSL 憑證錯誤\n```bash\n# 錯誤: curl: (60) SSL certificate problem: self signed certificate\n# 解決: 使用 -k 選項忽略憑證檢查 (僅用於測試)\ncurl -k \"https://test.com/api/test\"\n```\n\n#### 3. 認證失敗\n```bash\n# 錯誤: 401 Unauthorized\n# 解決: 檢查認證資訊\ncurl -u \"correct_username:correct_password\" \\\n     \"https://test.com/api/protected\"\n```\n\n#### 4. 超時錯誤\n```bash\n# 錯誤: curl: (28) Operation timed out\n# 解決: 增加超時時間\ncurl --max-time 30 \"https://test.com/api/slow\"\n```\n\n### 除錯技巧\n\n#### 1. 使用詳細模式\n```bash\ncurl -v \"https://test.com/api/users\"\n```\n\n#### 2. 檢查 HTTP 狀態碼\n```bash\ncurl -w \"HTTP 狀態碼: %{http_code}\\n\" \\\n     -s -o /dev/null \"https://test.com/api/users\"\n```\n\n#### 3. 測試 DNS 解析\n```bash\ncurl --resolve \"test.com:443:1.2.3.4\" \\\n     \"https://test.com/api/test\"\n```\n\n#### 4. 檢查重定向\n```bash\ncurl -L -v \"https://test.com/api/redirect\"\n```\n\n## 最佳實踐\n\n### 1. 安全性\n- 不要在命令列中直接輸入密碼\n- 使用環境變數儲存敏感資訊\n- 在生產環境中不要使用 `-k` 選項\n- 定期更新 curl 版本\n\n### 2. 效能優化\n- 使用 Keep-Alive 連線\n- 啟用壓縮\n- 適當設定超時時間\n- 使用連線池\n\n### 3. 錯誤處理\n- 檢查 HTTP 狀態碼\n- 設定適當的重試機制\n- 記錄錯誤日誌\n- 使用適當的超時設定\n\n### 4. 程式碼組織\n- 使用腳本檔案儲存複雜命令\n- 使用設定檔案管理參數\n- 添加註解說明\n- 版本控制腳本檔案\n\n### 範例腳本\n\n#### 基本 API 測試腳本\n```bash\n#!/bin/bash\n# api_test.sh\n\nAPI_BASE=\"https://test.com/api\"\nTOKEN=\"your-token-here\"\n\n# 測試 GET 請求\necho \"測試 GET 請求...\"\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     -w \"狀態: %{http_code}, 耗時: %{time_total}s\\n\" \\\n     -s -o /dev/null \"$API_BASE/users\"\n\n# 測試 POST 請求\necho \"測試 POST 請求...\"\ncurl -X POST \"$API_BASE/users\" \\\n     -H \"Content-Type: application/json\" \\\n     -H \"Authorization: Bearer $TOKEN\" \\\n     -d '{\"name\":\"測試使用者\",\"email\":\"test@example.com\"}' \\\n     -w \"狀態: %{http_code}, 耗時: %{time_total}s\\n\" \\\n     -s -o /dev/null\n```\n\n#### 健康檢查腳本\n```bash\n#!/bin/bash\n# health_check.sh\n\nENDPOINTS=(\n    \"https://test.com/api/health\"\n    \"https://test.com/api/status\"\n    \"https://test.com/api/version\"\n)\n\nfor endpoint in \"${ENDPOINTS[@]}\"; do\n    echo \"檢查: $endpoint\"\n    status=$(curl -w \"%{http_code}\" -s -o /dev/null \"$endpoint\")\n\n    if [ \"$status\" -eq 200 ]; then\n        echo \"✓ 正常 ($status)\"\n    else\n        echo \"✗ 異常 ($status)\"\n    fi\ndone\n```\n\n## 回應格式範例\n\n### 成功回應\n```json\n{\n  \"status\": \"success\",\n  \"data\": {\n    \"id\": 123,\n    \"name\": \"張三\",\n    \"email\": \"zhang@example.com\"\n  },\n  \"message\": \"操作成功\"\n}\n```\n\n### 錯誤回應\n```json\n{\n  \"status\": \"error\",\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"輸入資料驗證失敗\",\n    \"details\": {\n      \"email\": \"電子郵件格式不正確\"\n    }\n  }\n}\n```\n\n### HTTP 狀態碼說明\n- `200 OK` - 請求成功\n- `201 Created` - 資源建立成功\n- `204 No Content` - 請求成功但無內容\n- `400 Bad Request` - 請求格式錯誤\n- `401 Unauthorized` - 未授權\n- `403 Forbidden` - 禁止存取\n- `404 Not Found` - 資源不存在\n- `422 Unprocessable Entity` - 資料驗證失敗\n- `500 Internal Server Error` - 伺服器內部錯誤\n\n## 總結\n\ncurl 是一個功能強大的命令列工具，掌握其基本用法和進階功能對於 API 測試、資料傳輸和系統整合都非常重要。透過本手冊的說明和範例，您應該能夠有效地使用 curl 進行各種 HTTP 操作。\n\n記住要根據實際需求選擇適當的選項，並始終注意安全性和效能考量。\n","tocContent":""}