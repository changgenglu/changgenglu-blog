{"name":"PHP 屬性型別宣告指南.md","content":"# PHP 屬性型別宣告指南\n\n## 概述\n\n在 PHP 7.4+ 中，類別屬性支援型別宣告（Type Declaration），這是一個重要的語言特性，用於提升程式碼的型別安全性和可讀性。\n\n## 基本語法比較\n\n### 傳統宣告方式（無型別）\n\n```php\nclass Example {\n    private $dailyRankCache;\n    private $weeklyRankCache;\n    private $redis;\n    private $cacheTime;\n}\n```\n\n### 現代宣告方式（有型別）\n\n```php\nclass Example {\n    private RankCache $dailyRankCache;\n    private RankCache $weeklyRankCache;\n    private Redis $redis;\n    private int $cacheTime;\n}\n```\n\n## 型別宣告的意義與好處\n\n### 1. 型別安全性（Type Safety）\n\n**無型別宣告：**\n\n```php\nclass RankReport {\n    private $dailyRankCache;\n\n    public function setDailyCache($cache) {\n        $this->dailyRankCache = $cache; // 可以傳入任何型別\n    }\n}\n\n// 使用時可能出錯\n$report = new RankReport();\n$report->setDailyCache(\"string\"); // 錯誤的型別，但不會立即發現\n$report->setDailyCache(123);      // 錯誤的型別，但不會立即發現\n```\n\n**有型別宣告：**\n\n```php\nclass RankReport {\n    private RankCache $dailyRankCache;\n\n    public function setDailyCache(RankCache $cache) {\n        $this->dailyRankCache = $cache; // 只能傳入 RankCache 型別\n    }\n}\n\n// 使用時會立即發現錯誤\n$report = new RankReport();\n$report->setDailyCache(\"string\"); // Fatal Error: 型別不匹配\n$report->setDailyCache(123);      // Fatal Error: 型別不匹配\n```\n\n### 2. 程式碼可讀性\n\n**無型別宣告：**\n\n```php\nclass UserService {\n    private $cache;\n    private $repository;\n    private $logger;\n\n    public function __construct($cache, $repository, $logger) {\n        $this->cache = $cache;        // 不知道是什麼型別\n        $this->repository = $repository; // 不知道是什麼型別\n        $this->logger = $logger;      // 不知道是什麼型別\n    }\n}\n```\n\n**有型別宣告：**\n\n```php\nclass UserService {\n    private CacheInterface $cache;\n    private UserRepository $repository;\n    private LoggerInterface $logger;\n\n    public function __construct(\n        CacheInterface $cache,\n        UserRepository $repository,\n        LoggerInterface $logger\n    ) {\n        $this->cache = $cache;        // 明確知道是 CacheInterface\n        $this->repository = $repository; // 明確知道是 UserRepository\n        $this->logger = $logger;      // 明確知道是 LoggerInterface\n    }\n}\n```\n\n### 3. IDE 支援與自動完成\n\n**無型別宣告：**\n\n```php\nclass Example {\n    private $dailyRankCache;\n\n    public function someMethod() {\n        $this->dailyRankCache-> // IDE 不知道這是什麼型別，無法提供自動完成\n    }\n}\n```\n\n**有型別宣告：**\n\n```php\nclass Example {\n    private RankCache $dailyRankCache;\n\n    public function someMethod() {\n        $this->dailyRankCache-> // IDE 知道這是 RankCache，可以提供完整的自動完成\n    }\n}\n```\n\n### 4. 文件化與維護性\n\n**無型別宣告：**\n\n```php\n/**\n * 設定快取\n * @param mixed $cache 快取物件\n */\npublic function setCache($cache) {\n    $this->cache = $cache;\n}\n```\n\n**有型別宣告：**\n\n```php\n/**\n * 設定快取\n */\npublic function setCache(RankCache $cache) {\n    $this->cache = $cache;\n}\n```\n\n型別宣告本身就是最好的文件，不需要額外的 PHPDoc 註解。\n\n## 支援的型別\n\n### 基本型別\n\n```php\nclass Example {\n    private string $name;\n    private int $age;\n    private float $score;\n    private bool $isActive;\n    private array $data;\n    private ?string $nullableName; // 可為 null\n}\n```\n\n### 類別型別\n\n```php\nclass Example {\n    private RankCache $rankCache;\n    private UserCache $userCache;\n    private Redis $redis;\n    private DateTime $createdAt;\n}\n```\n\n### 介面型別\n\n```php\nclass Example {\n    private CacheInterface $cache;\n    private LoggerInterface $logger;\n    private RepositoryInterface $repository;\n}\n```\n\n### 聯合型別（PHP 8.0+）\n\n```php\nclass Example {\n    private string|int $id;\n    private RankCache|UserCache $cache;\n    private null|string $optionalField;\n}\n```\n\n## 實際應用範例\n\n### RankReport 類別中的應用\n\n```php\nclass RankReport {\n    // 明確宣告快取物件的型別\n    private RankCache $dailyRankCache;\n    private RankCache $weeklyRankCache;\n    private UserCache $dailyUserCache;\n    private UserCache $weeklyUserCache;\n\n    // 明確宣告 Redis 連接的型別\n    private Redis $redis;\n\n    // 明確宣告常數的型別\n    private const int DAILY_CACHE_TIME = 60 * 60 * 24 * 8;\n    private const int WEEKLY_CACHE_TIME = 60 * 60 * 24 * 7 * 5;\n\n    public function __construct() {\n        $this->redis = Redis::connection('report');\n    }\n\n    public function dailyRank(): RankCache {\n        if (!isset($this->dailyRankCache)) {\n            $this->dailyRankCache = new RankCache(\n                $this->redis,\n                self::CACHE_PREFIX_DAILY_RANK,\n                self::DAILY_CACHE_TIME\n            );\n        }\n        return $this->dailyRankCache;\n    }\n}\n```\n\n## 最佳實踐\n\n### 1. 總是使用型別宣告\n\n```php\n// 好的做法\nclass User {\n    private string $name;\n    private int $age;\n    private DateTime $createdAt;\n    private ?string $email;\n}\n\n// 避免的做法\nclass User {\n    private $name;\n    private $age;\n    private $createdAt;\n    private $email;\n}\n```\n\n### 2. 使用介面而非具體類別（依賴反轉）\n\n```php\n// 好的做法\nclass UserService {\n    private UserRepositoryInterface $repository;\n    private CacheInterface $cache;\n}\n\n// 避免的做法\nclass UserService {\n    private UserRepository $repository;\n    private Redis $cache;\n}\n```\n\n### 3. 使用可空型別處理可選屬性\n\n```php\nclass User {\n    private string $name;\n    private ?string $email = null; // 可為 null\n    private ?DateTime $lastLoginAt = null;\n}\n```\n\n### 4. 在建構子中初始化\n\n```php\nclass UserService {\n    private UserRepositoryInterface $repository;\n    private CacheInterface $cache;\n\n    public function __construct(\n        UserRepositoryInterface $repository,\n        CacheInterface $cache\n    ) {\n        $this->repository = $repository;\n        $this->cache = $cache;\n    }\n}\n```\n\n## 效能考量\n\n### 編譯時檢查\n\n- 型別宣告在編譯時就會被檢查，不會影響執行時效能\n- 實際上可能提升效能，因為 PHP 引擎可以進行更好的優化\n\n### 記憶體使用\n\n- 型別宣告本身不增加記憶體使用\n- 反而可能減少記憶體使用，因為引擎可以進行更精確的記憶體分配\n\n## 相容性考量\n\n### PHP 版本支援\n\n- PHP 7.4+：支援屬性型別宣告\n- PHP 8.0+：支援聯合型別\n- PHP 8.1+：支援唯讀屬性\n\n### 向後相容性\n\n```php\n// 如果需要在舊版本 PHP 中運行，可以使用 PHPDoc\n/**\n * @var RankCache\n */\nprivate $dailyRankCache;\n```\n\n## 總結\n\n屬性型別宣告的主要意義：\n\n1. **型別安全**：在編譯時捕獲型別錯誤\n2. **可讀性**：程式碼自文件化\n3. **IDE 支援**：更好的自動完成和錯誤檢查\n4. **維護性**：減少錯誤，提升程式碼品質\n5. **文件化**：型別本身就是最好的文件\n\n在現代 PHP 開發中，建議總是使用型別宣告，這是提升程式碼品質的重要實踐。\n","tocContent":""}