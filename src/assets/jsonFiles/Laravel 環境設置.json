{"name":"Laravel 環境設置.md","content":"# Laravel 環境設置\r\n\r\n>\r\n\r\n## 環境初始設定\r\n\r\n### 1. 安裝 XAMPP or phpEnv\r\n\r\n#### xampp 更改 php 版本: 版本 5 => 7\r\n\r\n> 注意！php 8.1 不相容 laravel 6.x 以下(包含 6)\r\n\r\n1. 開啟 Apache Admin 查看當前 XAMPP 所有版本資訊\r\n2. 到[XAMPP](https://windows.php.net/download/)下載要更新的 php 版本的 zip 檔。(注意！選擇 `Thread Safe` 版本！)\r\n3. 解壓縮定指定資料夾名稱為`php`，將此資料夾放至 XAMPP 資料夾中，並將原本的 php 資料夾另外命名\r\n4. 至 XAMPP 控制面板點選 `config` 按鈕，開啟 `httpd-xampp.conf` 檔，並修改其內容\r\n\r\n   1. 找到以下文字，並將其修改\r\n\r\n      修改前\r\n\r\n      ```txt\r\n      LoadFile \"C:/xampp/php/php5ts.dll\"\r\n      LoadFile \"C:/xampp/php/libpq.dll\"\r\n      LoadModule php5_module \"C:/xampp/php/php5apache2_4.dll\"\r\n      ```\r\n\r\n      修改後\r\n\r\n      ```txt\r\n      LoadFile \"C:/xampp/php/php7ts.dll\"\r\n      LoadFile \"C:/xampp/php/libpq.dll\"\r\n      LoadModule php7_module \"C:/xampp/php/php7apache2_4.dll\"\r\n      ```\r\n\r\n      - 修改時需確認修改路徑的檔案確實存在，若無此檔案，可能是 php 版本的關係\r\n\r\n   2. 將 `httpd-xampp.conf` 設定檔中所有 `php5_module` 改為 `php7_module`\r\n      - 在 php8 的 `httpd-xampp.conf` 設定檔為 `php_module`\r\n\r\n5. 重建 `php.ini` 設定檔\r\n\r\n   1. 複製 php 資料夾中的 php.ini-development，並重新命名為 php.ini\r\n   2. 開啟 php.ini 並依開發或網站需求，開啟相關模組(刪除前面的分號`;`)\r\n      1. `Dynamic Extensions` 動態延伸功能\r\n         - extension=curl\r\n         - extension=gd2(version 7) / gd(version 8)\r\n           - 在 php 8.0，DG 延伸功能 windows dll 文件名稱由 php_gd2.dll 改為 php_gd.dll)\r\n         - extension=mbstring\r\n         - **extension=mysqli**\r\n         - extension=openssl\r\n      2. `Paths and Directories` 路徑和目錄\r\n         - **extension_dir = \"ext\"**\r\n      3. 常見設定\r\n         - max_execution_time = 600\r\n         - short_open_tag = On\r\n         - max_input_time = 180\r\n         - **error_reporting=E_ALL & ~E_DEPRECATED & ~E_STRICT**\r\n           - 設置錯誤訊息通知，加入版本兼融性的提示\r\n         - memory_limit = 500M\r\n         - post_max_size = 500M\r\n         - upload_max_filesize = 100M\r\n         - max_file_uploads = 50\r\n\r\n6. 至 XAMPP 面板重啟 Apache\r\n7. 重新執行 composer update\r\n\r\n#### XAMPP 除錯\r\n\r\n> 問題：XAMPP 開啟 MySQL 失敗\r\n\r\n錯誤訊息：\r\n\r\n```txt\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Mutexes and rw_locks use Windows interlocked functions\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Uses event mutexes\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Compressed tables use zlib 1.2.12\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Number of pools: 1\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Using SSE2 crc32 instructions\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Initializing buffer pool, total size = 16M, instances = 1, chunk size = 16M\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Completed initialization of buffer pool\r\n2023-08-24 16:06:19 0 [Note] InnoDB: 128 out of 128 rollback segments are active.\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Creating shared tablespace for temporary tables\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Setting file 'C:\\xampp\\mysql\\data\\ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...\r\n2023-08-24 16:06:19 0 [Note] InnoDB: File 'C:\\xampp\\mysql\\data\\ibtmp1' size is now 12 MB.\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Waiting for purge to start\r\n2023-08-24 16:06:19 0 [Note] InnoDB: 10.4.27 started; log sequence number 72915773; transaction id 17227\r\n2023-08-24 16:06:19 0 [Note] InnoDB: Loading buffer pool(s) from C:\\xampp\\mysql\\data\\ib_buffer_pool\r\n2023-08-24 16:06:19 0 [Note] Plugin 'FEEDBACK' is disabled.\r\n2023-08-24 16:06:19 0 [Note] Server socket created on IP: '::'.\r\n```\r\n\r\n解決辦法：\r\n\r\n1. 先到路徑：`C:\\xampp\\mysql\\data`\r\n2. 將 data 資料夾備份\r\n3. 再建立一個新的 data 資料夾\r\n4. 建立後重啟 mysql\r\n5. 重啟失敗後，data 資料夾會新增程式自動建立的檔案\r\n6. 此時將`C:\\xampp\\mysql\\backup`中的資料夾複製到 data 資料夾中\r\n7. 這時再重啟 mysql 已經可以正常運行了，接下來將就的資料庫加回來\r\n8. 此時先關閉 mysql，將剛剛備份的 data 資料夾底下的資料夾與 `ibdata1` 檔案，複製到新的 data 資料夾底下\r\n9. 重啟 mysql 即可\r\n\r\n### macOS Monterey 上安裝 PHP\r\n\r\n> 問題：安裝完 MAMP 之後，要用終端機安裝 composer，結果出現`zsh: command not found: php`\r\n>\r\n> 原因：MacOS Monterey 版本，預設沒有安裝 PHP。\r\n\r\n1. 安裝 PHP\r\n   [Installing PHP on your Mac](https://daily-dev-tips.com/posts/installing-php-on-your-mac/)\r\n\r\n1. 安裝 Homebrew\r\n   在 terminal 輸入\r\n\r\n   ```terminal\r\n   /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\r\n   ```\r\n\r\n   顯示路徑問題的解決辦法\r\n\r\n   ```terminal\r\n   echo 'eval \"$(/opt/homebrew/bin/brew shellenv)\"' >> /Users/changgenglu/.zprofile\r\n\r\n   eval \"$(/opt/homebrew/bin/brew shellenv)\"\r\n   ```\r\n\r\n1. 使用 Homebrew 安裝 PHP\r\n   先確定 Homebrew 安裝成功\r\n\r\n   ```terminal\r\n   brew update\r\n   brew doctor\r\n   ```\r\n\r\n   安裝 PHP\r\n\r\n   ```terminal\r\n   brew install php\r\n   ```\r\n\r\n   安裝特定版本\r\n\r\n   ```terminal\r\n   brew install php@7.4\r\n   ```\r\n\r\n   - 安裝指定版本後，並不會自動切換 PHP 本版本\r\n\r\n1. 使用 Homebrew 切換 PHP\r\n   檢查當前版本\r\n\r\n   ```terminal\r\n   php -v\r\n\r\n   # PHP 8.0.1 (cli) (built: Jan  8 2021 01:27:28) ( NTS )\r\n   ```\r\n\r\n   取消該版本\r\n\r\n   ```terminal\r\n   brew unlink php@8.0\r\n   ```\r\n\r\n   選擇版本\r\n\r\n   ```terminal\r\n   brew link php@7.4\r\n   ```\r\n\r\n   出現路徑問題，提示：須遜行腳本來添加路徑\r\n\r\n   ```terminal\r\n   echo 'export PATH=\"/opt/homebrew/opt/php@7.4/bin:$PATH\"' >> ~/.zshrc\r\n\r\n   ```\r\n\r\n### 2. 安裝 composer\r\n\r\n#### windows 透過 composer 官網下載 composer 安裝檔\r\n\r\n#### 下載 Composer: MacOS\r\n\r\n- 代碼以[Composer 官網](https://getcomposer.org/download/)為主\r\n\r\n下載安裝程序到當前目錄\r\n\r\n```bash\r\nphp -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\r\n```\r\n\r\n驗證安裝程序\r\n\r\n```bash\r\nphp -r \"if (hash_file('sha384', 'composer-setup.php') === '906a84df04cea2aa72f40b5f787e49f22d4c2f19492ac310e8cba5b96ac8b64115ac402c8cd292b8a03482574915d1a8') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\r\n```\r\n\r\n運行安裝程序\r\n\r\n```bash\r\nphp composer-setup.php\r\n```\r\n\r\n刪除安裝程序\r\n\r\n```bash\r\nphp -r \"unlink('composer-setup.php');\"\r\n```\r\n\r\n- MacOS 如果出現 `zsh: command not found: php`\r\n\r\n  原因：MacOS Monterry 版本，沒有包括 PHP。請參考：[macOS Monterey 上安裝 PHP](https://hackmd.io/wnFCr0GUS-iIRxHY2zrBgw)\r\n\r\n- MacOS 須確保 Composer 的系統等級 vendor bin 資料夾有放在$PATH 中，這樣作業系統才能找到`laravel` 可執行檔。一般常見的位置如下：\r\n  - macOS: $HOME/.composer/vendor/bin\r\n  - Windows: %USERPROFILE%\\AppData\\Roaming\\Composer\\vendor\\bin\r\n\r\n#### 全局調用 Composer: MacOS\r\n\r\n確認是否成功安裝 Composer\r\n\r\n```bash\r\nls\r\n\r\n// 要看到有composer.phar的檔案\r\n```\r\n\r\n將 composer.phar 放入本地的目錄\r\n\r\n```bash\r\nsudo mv composer.phar /usr/local/bin/composer\r\n```\r\n\r\n測試是否安裝成功\r\n\r\n```bash\r\ncomposer\r\n```\r\n\r\n### 3. 安裝 Visual Studio Code or phpStorm\r\n\r\n### 4. Laravel 全域安裝 XAMPP\r\n\r\n```bash\r\ncd c:\\xampp\\htdocs\r\ncomposer global require laravel/installer\r\n\r\nlaravel new project_name\r\n\r\ncd project_name\r\n\r\nphp artisan serve\r\n```\r\n\r\n## 從 Git clone Laravel 專案\r\n\r\n由於安全性及維護的考量，Laravel 預設有 .gitignore，所以較為敏感的檔案，不會被 push 上去。\r\n因此專案 clone 下來之後，必須要重建才能正常執行。\r\n\r\n### 開發環境設定\r\n\r\n1. 安裝依賴套件\r\n\r\n   ```bash\r\n   composer install\r\n   ```\r\n\r\n2. 設定.env 檔\r\n\r\n   複製.env.example 並更改為.env\r\n\r\n   ```bash\r\n   cp .env.example .env\r\n   ```\r\n\r\n   修改.env\r\n\r\n3. 設定加密的 APP_KEY\r\n\r\n   ```bash\r\n   php artisan key:generate\r\n   ```\r\n\r\n4. 設定資料庫\r\n\r\n   建立 MySQL 所需的資料庫\r\n\r\n5. Migration 和 Seeding 建立資料表結構\r\n\r\n   ```cmd\r\n   php artisan migrate\r\n   &\r\n   php artisan db:seed\r\n   &\r\n   php artisan migrate --seed\r\n   ```\r\n\r\n6. 若有安裝 passport 需運行命令產生 Access Token\r\n\r\n   ```bash\r\n   php artisan passport:install\r\n   ```\r\n\r\n7. 建立符號連結\r\n   如果有使用到 public storage （如：Storage::disk('public')），\r\n   記得使用以下指令，將 storage 軟連結到 storage/app/public\r\n\r\n   ```cmd\r\n   php artisan storage:link\r\n   ```\r\n\r\n8. 設定伺服器\r\n\r\n   例如到 NGINX 新增、調整 conf 檔\r\n\r\n9. 設定任務排程\r\n\r\n   如果有在 Laravel 中定義排程的任務，\r\n   記得在 crontab 中增加 Laravel 指令排程器\r\n\r\n   ```cmd\r\n   # 在 crontab -e 中\r\n   * * * * * php /path-to-your-project/artisan schedule:run >> /dev/null 2>&1\r\n   ```\r\n\r\n### 上線環境設定\r\n\r\n1. 安裝 composer 排除 dev 項目\r\n\r\n   ```bash\r\n   composer install --optimize-\r\n   loader --no-dev\r\n   ```\r\n\r\n2. `.env`設定轉為線上並且關閉錯誤提示\r\n\r\n   ```php\r\n   APP_NAME=專案名稱\r\n   APP_ENV=production\r\n   APP_KEY=\r\n   APP_DEBUG=false\r\n   APP_URL=https://正式網址\r\n   ```\r\n\r\n3. 設定快取\r\n\r\n   ```bash\r\n   php artisan config:cache\r\n\r\n   #　下次更新程式記得更新config\r\n   php artisan config:clear\r\n   ```\r\n\r\n4. Router 快取  \r\n   error: (Unable to prepare route [api/user] for serialization. Uses Closure. )\r\n\r\n   ```bash\r\n   php artisan route:cache\r\n\r\n   # 下次更新程式記得更新route\r\n   php artisan route:clear\r\n   php artisan cache:clear\r\n   ```\r\n\r\n5. Composer 緩存\r\n\r\n   ```bash\r\n   composer dump\r\n   load -o\r\n   # 每次更新composer install 後，都要再執行一次\r\n   ```\r\n\r\n6. 類別緩存  \r\n   error: (Unable to prepare route [api/user] for serialization. Uses Closure. )\r\n\r\n   ```bash\r\n   php artisan optimize\r\n   ```\r\n\r\n7. 清除類別緩存\r\n\r\n   ```bash\r\n   php artisan clear-compiled\r\n   ```\r\n\r\n8. 建立 keygen\r\n\r\n   ```bash\r\n   php artisan key:generate\r\n   ```\r\n\r\n9. 若有安裝 passport 需運行命令產生 Access Token\r\n\r\n   ```bash\r\n   php artisan passport:keys\r\n   ```\r\n\r\n10. 執行\r\n\r\n```bash\r\n# 遷移資料表\r\nphp artisan migrate\r\n# 填充資料\r\nphp artisan db:seed\r\n```\r\n\r\n### composer install 失敗\r\n\r\n```shell\r\nnode: /lib64/libm.so.6: version `GLIBC_2.27` not found (required by node)\r\nnode: /lib64/libc.so.6: version `GLIBC_2.28` not found (required by node)\r\nnode: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.28` not found (required by node)\r\n```\r\n\r\n當出現上面的錯誤訊息，表示 GLIBC 的版本不符合現行系統上的 node 版本。\r\n\r\n解決錯誤常見的方法有兩種：\r\n\r\n1. 安裝較舊、支援更廣泛的 Node.js (16.x) 版本\r\n\r\n   使用 `nvm` 安裝其他版本的 node.js\r\n\r\n   ```shell\r\n   nvm install 16\r\n   nvm use 16\r\n   ```\r\n\r\n   完成後確認當前版本\r\n\r\n   ```shell\r\n   nvm ls\r\n   node --version\r\n   ```\r\n\r\n   移除特定版本\r\n\r\n   ```shell\r\n   # 👇️ uninstall Node.js version 13.X.X\r\n   nvm uninstall 13\r\n   ```\r\n\r\n   若還未安裝 nvm\r\n\r\n   ```shell\r\n   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.2/install.sh | bash\r\n   chmod +x ~/.nvm/nvm.sh\r\n   source ~/.bashrc\r\n   # 驗證 nvm 是否安裝成功\r\n   nvm -v\r\n   ```\r\n\r\n2. 將 Linux 操作系統升級到更新版本。\r\n\r\n## Laravel ReactJS\r\n\r\n> Use laravel/ui Package to install react in laravel with Bootstrap 4.\r\n\r\n1. 建立新的專案\r\n\r\n   ```cmd\r\n   composer create-project laravel/laravel --prefer-dist running_in_circles\r\n\r\n   laravel new running_in_circles\r\n   ```\r\n\r\n2. 進入 Laravel 項目\r\n\r\n   ```cmd\r\n   cd running_in_circles\r\n   ```\r\n\r\n3. 安裝 laravel/ui\r\n\r\n   ```cmd\r\n   composer require laravel/ui\r\n   ```\r\n\r\n4. 在 Laravel 中安裝 React\r\n\r\n   ```cmd\r\n   php artisan ui react\r\n   ```\r\n\r\n5. 安裝所需的軟件包\r\n\r\n   ```cmd\r\n   <!-- 檢查node和npm是否安裝 -->\r\n       node -v\r\n       npm -v\r\n   <!-- 建立一個node_modules資料夾並自動安裝package.json -->\r\n       npm install\r\n   ```\r\n\r\n6. 在 Laravel 中設置 React 組件\r\n\r\n   ```javascript\r\n   // 路徑 ==> resource/js/components/User.js\r\n   import React from \"react\";\r\n   import ReactDOM from \"react-dom\";\r\n\r\n   function User() {\r\n     return (\r\n       <div className=\"container mt-5\">\r\n         <div className=\"row justify-content-center\">\r\n           <div className=\"col-md-8\">\r\n             <div className=\"card text-center\">\r\n               <div className=\"card-header\">\r\n                 <h2>React Component in Laravel</h2>\r\n               </div>\r\n               <div className=\"card-body\">I am tiny React component in Laravel app!</div>\r\n             </div>\r\n           </div>\r\n         </div>\r\n       </div>\r\n     );\r\n   }\r\n\r\n   export default User;\r\n\r\n   // DOM element\r\n   if (document.getElementById(\"user\")) {\r\n     ReactDOM.render(<User />, document.getElementById(\"user\"));\r\n   }\r\n   ```\r\n\r\n7. 修改 resources/js/app.js 註冊 React 文件\r\n\r\n   ```javascript\r\n   require(\"./bootstrap\");\r\n\r\n   // Register React components\r\n   require(\"./components/Example\");\r\n   require(\"./components/User\");\r\n   ```\r\n\r\n8. 修改 views/welcome.blade.php 模板\r\n\r\n   ```html\r\n   <!DOCTYPE html>\r\n   <html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\">\r\n     <head>\r\n       <meta charset=\"utf-8\" />\r\n       <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n       <title>Laravel</title>\r\n       <!-- Styles -->\r\n       <link href=\"{{ asset('css/app.css') }}\" rel=\"stylesheet\" />\r\n     </head>\r\n\r\n     <body>\r\n       <!-- React root DOM -->\r\n       <div id=\"user\"></div>\r\n       <!-- React JS -->\r\n       <script src=\"{{ asset('js/app.js') }}\" defer></script>\r\n     </body>\r\n   </html>\r\n   ```\r\n\r\n9. 執行命令編譯 Laravel 和 React.js\r\n\r\n   ```cmd\r\n   npm run watch\r\n   ```\r\n\r\n10. 編譯成功，運行 laravel\r\n\r\n```cmd\r\nphp artisan serve\r\n```\r\n\r\n## Laravel 安裝 bootstrap\r\n\r\n### Laravel 8\r\n\r\n1. 終端機\r\n\r\n   ```cmd\r\n   npm install\r\n   ```\r\n\r\n2. 建立文件(如果尚未建立) `resources/sass/app.scss` 並引入:\r\n   `@import '~bootstrap';`\r\n\r\n3. 在 webpack.mix.js 加入\r\n\r\n   ```php\r\n   mix.sass('resources/sass/app.scss', 'public/css')\r\n   ```\r\n\r\n4. 終端機\r\n\r\n   ```cmd\r\n   npm run dev\r\n   ```\r\n\r\n5. 現在可以引用 bootstrap\r\n\r\n   ```php\r\n   <link href=\"{{ asset('css/app.css') }}\" rel=\"stylesheet\">\r\n   ```\r\n\r\n### Laravel 6\r\n\r\n1. 終端機輸入\r\n\r\n   ```cmd\r\n   composer require laravel/ui=\"1.*\" --dev\r\n   ```\r\n\r\n2. 輸入\r\n\r\n   ```cmd\r\n   php artisan ui bootstrap\r\n   ```\r\n\r\n3. 如果出現 \"Command \"ui\" is not defined.\"\r\n\r\n   ```cmd\r\n   composer update\r\n   ```\r\n\r\n4. 執行\r\n\r\n   ```cmd\r\n   npm install\r\n   ```\r\n\r\n5. 終端機\r\n\r\n   ```cmd\r\n   npm run dev\r\n   ```\r\n\r\n6. 現在可以引入\r\n\r\n   ```php\r\n   <link rel=\"stylesheet\" href=\"/css/app.css\">\r\n   <script src=\"/js/app.js\"></script>\r\n   ```\r\n\r\n## Laravel Telescope\r\n\r\n提供察看 laravel 中的請求、異常、日誌、資料庫查詢等等功能\r\n\r\n### 安裝\r\n\r\n利用 composer 安裝到 laravel 中\r\n\r\n```bash\r\ncomposer require laravel/telescope\r\n```\r\n\r\n安裝後使用 artisan 命令發布資產\r\n\r\n```bash\r\nphp artisan telescope:install\r\n```\r\n\r\n並運行 migrate\r\n\r\n```bash\r\nphp artisan migrate\r\n```\r\n\r\n若指定在開發環境中安裝，則再發布資產後薛將配置文件，從 config/app.php 中註解，並在 AppServiceProvider 手動註冊服務\r\n\r\n```bash\r\n# 指定在開發環境中安裝\r\ncomposer require laravel/telescope --dev\r\n```\r\n","tocContent":"- [Laravel 環境設置](#laravel-環境設置)\r\n  - [環境初始設定](#環境初始設定)\r\n    - [1. 安裝 XAMPP or phpEnv](#1-安裝-xampp-or-phpenv)\r\n      - [xampp 更改 php 版本: 版本 5 =\\> 7](#xampp-更改-php-版本-版本-5--7)\r\n      - [XAMPP 除錯](#xampp-除錯)\r\n    - [macOS Monterey 上安裝 PHP](#macos-monterey-上安裝-php)\r\n    - [2. 安裝 composer](#2-安裝-composer)\r\n      - [windows 透過 composer 官網下載 composer 安裝檔](#windows-透過-composer-官網下載-composer-安裝檔)\r\n      - [下載 Composer: MacOS](#下載-composer-macos)\r\n      - [全局調用 Composer: MacOS](#全局調用-composer-macos)\r\n    - [3. 安裝 Visual Studio Code or phpStorm](#3-安裝-visual-studio-code-or-phpstorm)\r\n    - [4. Laravel 全域安裝 XAMPP](#4-laravel-全域安裝-xampp)\r\n  - [從 Git clone Laravel 專案](#從-git-clone-laravel-專案)\r\n    - [開發環境設定](#開發環境設定)\r\n    - [上線環境設定](#上線環境設定)\r\n    - [composer install 失敗](#composer-install-失敗)\r\n  - [Laravel ReactJS](#laravel-reactjs)\r\n  - [Laravel 安裝 bootstrap](#laravel-安裝-bootstrap)\r\n    - [Laravel 8](#laravel-8)\r\n    - [Laravel 6](#laravel-6)\r\n  - [Laravel Telescope](#laravel-telescope)\r\n    - [安裝](#安裝)"}