{"name":"Docker 學習筆記.md","content":"# Docker 學習筆記\r\n\r\n>\r\n\r\n> 參考資料：\r\n>\r\n> [Docker 基本知識 以及 Docker Compose 實戰經驗](https://hackmd.io/@leonsnoopy/Sya_DevI7#Docker-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AD%98-%E4%BB%A5%E5%8F%8A-Docker-Compose%E5%AF%A6%E6%88%B0%E7%B6%93%E9%A9%97)\r\n>\r\n> [基礎系統及 docker hub 指令](https://joshhu.gitbooks.io/dockercommands/content/Basics/Basics.html)\r\n>\r\n> [How to Deploy Laravel with Docker on Ubuntu 18.04](https://help.clouding.io/hc/en-us/articles/360010679999-How-to-Deploy-Laravel-with-Docker-on-Ubuntu-18-04)\r\n>\r\n> [Laravel 實戰經驗分享 - Day26 Dockerize 你的 Laravel 專案](https://ithelp.ithome.com.tw/articles/10251844)\r\n\r\n## 安裝 Docker: Docker for Windows\r\n\r\n> Windows 10\r\n> 需啟用 Hyper-v\r\n> 控制台 -> 程式和功能 -> 開啟或關閉 Windows 功能\r\n> 將\"Hyper-v\"和\"容器\"設為開啟\r\n\r\n- 下載[Docker for Windows](https://docs.docker.com/desktop/get-started/)\r\n\r\n## 基本概念\r\n\r\n- docker 主要元件：\r\n  - `image` 映像檔\r\n  - `container` 容器\r\n  - `repository` 倉庫\r\n\r\n執行 docker 的主機稱為 Host，當 Host 執行 `docker run` 指令時，Docker 會操作這三個元素。\r\n\r\n- Image、container、repository 之間的關係就像光碟一樣：早期世紀帝國等光碟遊戲，會需要搭配其他可讀寫空間（如硬碟），才有辦法執行。\r\n  - image 像光碟片，唯獨且無法獨立執行。\r\n  - container 像硬碟，可讀可寫可執行。\r\n  - repository 像光碟盒，儲存 image。\r\n  - registry 則是光碟零售商。\r\n\r\n### Image\r\n\r\n- image 包裝了一個執行特定環境所需要的資源。\r\n  每個 image 都有獨一無二的 digest，這是從 image 內容作 sha256 產生的。這個是能讓 image 無法隨意更變內容，維持資料的一致性。\r\n\r\n雖然 image 裡有必要的資源，但他無法獨立執行，必須靠 container 間接執行。\r\n\r\n### Container\r\n\r\n- 基於 image 可以建立出 Container。\r\n  他的概念像是建立一個可讀寫內容的外層，架在 image 之上。實際存取 container 會經過可讀寫層與 image，因此看到的內容會是兩者合併後的結果。\r\n\r\nContainer 特性與 image 不一樣，因為有可讀寫層，所以 container 可以讀寫，也可以拿來執行。\r\n\r\n### Repository\r\n\r\n- repository 是存放 image 的空間\r\n  docker 的設計類似`分散式版本控制`的方法來存的方法來存放各種 image，而分散式架構就會有類似 git 的 pull/push 行為，實際做的事情也跟 git 類似：為了要跟遠端的 repository 同步。\r\n\r\n另一個與 repository 很像，但容易混用的詞為 Registry。Registry 涵蓋範圍更廣，包含了更多 repository 與身分驗證功能等，通常比較常討論的也是 registry。\r\n\r\n目前 docker 上面預設的 registry 為 DockerHub，大多數程式或服務的 image 都可以在上面找到。\r\n\r\n## Hello World\r\n\r\n```bash\r\n$ docker run hello-world\r\nUnable to find image 'hello-world:latest' locally\r\nlatest: Pulling from library/hello-world\r\n0e03bdcc26d7: Pull complete\r\nDigest: sha256:7f0a9f93b4aa3022c3a4c147a449bf11e0941a1fd0bf4a8e6c9408b2600777c5\r\nStatus: Downloaded newer image for hello-world:latest\r\n\r\nHello from Docker!\r\n```\r\n\r\n- `docker run <image name>` 會建立一個 container 並執行，而因為 container 需要基於 image 建立，所以 docker run 有一個必要參數為 `image name`。\r\n\r\n### 確認 Image 存在於 Repository\r\n\r\n首先先確認 `hello-world` 是否存在於本機的 repository，本機找不到的話，就需要從遠端的 repository 下載。\r\n\r\n```bash\r\nUnable to find image 'hello-world:latest' locally\r\nlatest: Pulling from library/hello-world\r\n0e03bdcc26d7: Pull complete\r\nDigest: sha256:7f0a9f93b4aa3022c3a4c147a449bf11e0941a1fd0bf4a8e6c9408b2600777c5\r\nStatus: Downloaded newer image for hello-world:latest\r\n```\r\n\r\n### 建立 Container 並執行\r\n\r\n確認 image 存在後，即可建立 container 並執行。\r\n\r\n- `docker run` 預設的行為是：\r\n  1. 前景建立並執行 container\r\n  2. 等待執行程式結束後，會回到前景的命令提示字元\r\n  3. 該 container 會被標記為結束狀態。\r\n\r\n### 列出所有已建立的 container\r\n\r\n```bash\r\ndocker ps -a\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES\r\n6d7e00198a56        hello-world         \"/hello\"            12 seconds ago      Exited (0) 11 seconds ago                       relaxed_bhabha\r\n```\r\n\r\n`STATUS` 表示 container 的狀態，`Exited(0)` 後面的數字為程式結束後回傳的狀態碼，通常 0 為正常結束，非 0 則唯有錯誤。\r\n\r\n`CONTAINER ID` 和 `NAMES` 為獨一無二，執行多次 `docker run` 後，會生不一樣名字的 container。\r\n\r\n### 移除 container\r\n\r\n若一直執行 `docker run` 會使 container 數量不斷增加，一般而言沒有再用到的 container 就會將他移除\r\n\r\n```bash\r\n# 移除時使用 CONTAINER ID 和 NAMES 都可以。\r\ndocker rm 6d7e00198a56\r\n\r\n#移除後再檢查一次\r\ndocker ps -a\r\n```\r\n\r\n## ubuntu\r\n\r\n### pull\r\n\r\n```bash\r\n# 搜尋 ubuntu\r\ndocker search ubuntu\r\n# 將 ubuntu 的 image pull 下來\r\ndocker pull ubuntu\r\n```\r\n\r\n查看 docker 的 image，應可以看到最新版本的 ubuntu\r\n\r\n```bash\r\ndocker images\r\n```\r\n\r\n| REPOSITORY | TAG    | IMAGE ID     | CREATED     | SIZE   |\r\n| ---------- | ------ | ------------ | ----------- | ------ |\r\n| ubuntu     | latest | 6b7dfa7e8fdb | 3 weeks ago | 77.8MB |\r\n\r\n### 啟動\r\n\r\n```bash\r\n> docker run -itd --name ubuntu-test ubuntu\r\n6ffebdd2bce193afe7e3fbaa53c6f2e1dffa845e2c8ec55fef899ba191470dbc\r\n```\r\n\r\n進入容器\r\n\r\n```bash\r\n> docker exec -it ubuntu-test bash\r\nroot@6ffebdd2bce1:/#\r\n```\r\n\r\n## For Laravel: Laradock\r\n\r\n### 環境要求\r\n\r\n> Git\r\n> docker\r\n> docker-compose\r\n\r\n- 將 laradock 的 repository clone 下來\r\n\r\n  ```bash\r\n  git clone https://github.com/Laradock/laradock.git Laradock\r\n  ```\r\n\r\n### 資料結構\r\n\r\n#### laradock/.env\r\n\r\n- 在 laradock 的資料夾中複製 .env.example 並改名為 .env\r\n\r\n  ```bash\r\n  cp .env.example .env\r\n  ```\r\n\r\n- 編輯 .env 中的設定\r\n\r\n```vim\r\n### Paths #################################################\r\n# Point to the path of your applications code on your host\r\n# 專案要放在本機的哪個資料夾中\r\n# 這邊放在與 laradock 同層級的 test 資料夾中\r\nAPP_CODE_PATH_HOST=../test\r\n\r\n# Point to where the `APP_CODE_PATH_HOST` should be in the container\r\n# 設定專案要同步到 container 中的哪一個路徑，預設為 /var/www\r\nAPP_CODE_PATH_CONTAINER=/var/www\r\n\r\n# You may add flags to the path `:cached`, `:delegated`. When using Docker Sync add `:nocopy`\r\nAPP_CODE_CONTAINER_FLAG=:cached\r\n\r\n# Choose storage path on your machine. For all storage systems\r\n# 設定你的儲存資料(ex. database, redis 內的數據)要存放在哪。\r\n# 這邊是放在跟 laradock 專案同層級的 data 資料夾中\r\nDATA_PATH_HOST=../data\r\n```\r\n\r\n#### mysql\r\n\r\n若 PhpMyAdmin 登不進去，可能是版本問題\r\n\r\n```vim\r\n# 預設值\r\nMYSQL_VERSION=latest\r\n\r\n# 改為\r\nMYSQL_VERSION=5.7\r\n```\r\n\r\n#### PhpMyAdmin\r\n\r\n```vim\r\n### PHP MY ADMIN ##########################################\r\n\r\n# Accepted values: mariadb - mysql\r\n# 連接的 BD (預設為 mysql)\r\nPMA_DB_ENGINE=mysql\r\n\r\n# Credentials/Port:\r\n\r\n# 預設的使用者\r\nPMA_USER=default\r\n# 預設密碼\r\nPMA_PASSWORD=secret\r\n# sql root 帳號的密碼\r\nPMA_ROOT_PASSWORD=secret\r\n# phpMyAdmin 執行的 port 號\r\nPMA_PORT=8081\r\nPMA_MAX_EXECUTION_TIME=600\r\nPMA_MEMORY_LIMIT=256M\r\nPMA_UPLOAD_LIMIT=2G\r\n```\r\n\r\n#### apache2\r\n\r\n#### nginx\r\n\r\n### 啟動\r\n\r\n- 啟動 laradock\r\n\r\n```bash\r\ndocker-compose up -d apache2 phpMyAdmin nginx ...想啟動的服務\r\n```\r\n\r\nLaradock 會自動啟動包括 php-fpm 在內的 php-fpm 及 workspace，啟動 phpMyAdmin 時也會連帶啟動 mysql\r\n\r\n- 進入 laravel 專案\r\n\r\n在啟動 laradock 之後，會建立一個 workspace 的 container，此時進入 workspace 建立 laravel 專案\r\n\r\n```bash\r\ndocker-compose exec workspace bash\r\n```\r\n\r\n進入後，terminal 會顯示自己在 `/var/www` 中，此時 `/var/www` 是連接我們在 .env 中設定的資料夾 `../test`\r\n","tocContent":"- [Docker 學習筆記](#docker-學習筆記)\r\n  - [安裝 Docker: Docker for Windows](#安裝-docker-docker-for-windows)\r\n  - [基本概念](#基本概念)\r\n    - [Image](#image)\r\n    - [Container](#container)\r\n    - [Repository](#repository)\r\n  - [Hello World](#hello-world)\r\n    - [確認 Image 存在於 Repository](#確認-image-存在於-repository)\r\n    - [建立 Container 並執行](#建立-container-並執行)\r\n    - [列出所有已建立的 container](#列出所有已建立的-container)\r\n    - [移除 container](#移除-container)\r\n  - [ubuntu](#ubuntu)\r\n    - [pull](#pull)\r\n    - [啟動](#啟動)\r\n  - [For Laravel: Laradock](#for-laravel-laradock)\r\n    - [環境要求](#環境要求)\r\n    - [資料結構](#資料結構)\r\n      - [laradock/.env](#laradockenv)\r\n      - [mysql](#mysql)\r\n      - [PhpMyAdmin](#phpmyadmin)\r\n      - [apache2](#apache2)\r\n      - [nginx](#nginx)\r\n    - [啟動](#啟動-1)"}